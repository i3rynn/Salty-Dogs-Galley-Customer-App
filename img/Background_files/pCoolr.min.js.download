/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version: 3.1.12
 *
 * Requires: jQuery 1.2.2+
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\"+q[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);
if(typeof PAYPAL=='undefined'||!PAYPAL){var PAYPAL={};}
PAYPAL.apps=PAYPAL.apps||{};(function(){var defaultConfig={trigger:null,expType:null,sole:'true',stage:null,port:null};PAYPAL.apps.DGFlow=function(userConfig){var that=this;that.UI={};that.miniWin={};that._init(userConfig);return{setTrigger:function(el){that._setTrigger(el);},startFlow:function(url){var win=that._render();if(win.location){win.location=url;}else{win.src=url;}},closeFlow:function(){that._destroy();},isOpen:function(){if(that.dgWindow){if(that.dgWindow=='incontext'){return that.isOpen;}else{if(typeof that.dgWindow=='object'){return(!that.dgWindow.closed);}else{return false;}}}else{return that.isOpen;}}};};PAYPAL.apps.DGFlow.prototype={name:'PPDGFrame',isOpen:false,NoB:true,dgWindow:'incontext',RMC:false,_init:function(userConfig){if(userConfig){for(var key in defaultConfig){if(typeof userConfig[key]!=='undefined'){this[key]=userConfig[key];}else{this[key]=defaultConfig[key];}}}
this.port=(this.port==null)?"":":"+this.port;this.stage=(this.stage==null)?"www.paypal.com":"www."+this.stage+".paypal.com"+this.port;if(this.trigger){this._setTrigger(this.trigger);}
this._addCSS();if(this.NoB==true&&this.sole=='true'){var url="https://"+this.stage+"/webapps/checkout/nameOnButton.gif";this._getImage(url,this._addImage);}},_launchMiniWin:function(){if(this.miniWin.state!=undefined){if(!this.miniWin.twin.closed){this.miniWin.twin.focus();return this.miniWin;}else{this.miniWin={};return this._openMiniBrowser();}}else{return this._openMiniBrowser();}},_launchMask:function(){this._createMask();this._centerLightbox();this._bindEvents();},_render:function(){var ua=navigator.userAgent,win;if(ua.match(/iPhone|iPod|iPad|Android|Blackberry.*WebKit/i)){win=window.open('',this.name);this.dgWindow=win;return win;}else{switch(this.expType){case"mini":this._buildDOMMB();this._launchMask();case"popup":return this._launchMiniWin();break;case"instant":if(!this.RMC){this._buildDOMMB();this._launchMask();return this._launchMiniWin();break;}
default:this._buildDOM();this._launchMask();this.isOpen=true;return this.UI.iframe;}}},_openMiniBrowser:function(){var width=420,height=560,left,top,win;var winOpened=false;if(window.outerWidth){left=Math.round((window.outerWidth-width)/2)+window.screenX;top=Math.round((window.outerHeight-height)/2)+window.screenY;}else if(window.screen.width){left=Math.round((window.screen.width-width)/2);top=Math.round((window.screen.height-height)/2);}
win=window.open('about:blank',this.name,'top='+top+', left='+left+', width='+width+', height='+height+', location=1, status=1, toolbar=0, menubar=0, resizable=0, scrollbars=1');try{win.document.write("<style>#myDiv{position:absolute; left:36%; top:27%; font-style:italic; font-weight:bold; font-family:arial,Helvetica,sans-serif; font-size:75%; color:#084482; }</style><body><div id=\"myDiv\">LOADING <span id=\"mySpan\"> </span></div></body><script>var sspan = document.getElementById('mySpan');var int = setInterval(function() { if ((sspan.innerHTML += '.').length == 4)  sspan.innerHTML = '';}  , 200);</script>");}catch(err){}
this.miniWin.state=false;this.dgWindow=win;winOpened=true;if(this.expType=="instant"||this.expType=="mini"){var dgObj=this;if(winOpened){intVal=setInterval(function(){if(win&&win.closed){clearInterval(intVal);winOpened=false;return dgObj._destroy();}},1000);}
addEvent(this.UI.goBtn,'click',this._launchMiniWin,this);addEvent(this.UI.closer,'click',this._destroy,this);}
this.miniWin.twin=win;return win;},_addCSS:function(){var css='',styleEl=document.createElement('style');css+='#'+this.name+' { z-index:20002; position:absolute; top:0; left:0; }';css+='#'+this.name+' .panel { z-index:20003; position:relative; }';css+='#'+this.name+' .panel iframe { width:385px; height:550px; border:0; }';css+='#'+this.name+' .mask { z-index:20001; position:absolute; top:0; left:0; background-color:#000; opacity:0.2; filter:alpha(opacity=20); }';css+='.nameOnButton { display: inline-block; text-align: center; }';css+='.nameOnButton img { border:none; }';if((this.expType=="instant"&&!this.RMC)||this.expType=="mini"){css+='#'+this.name+' .panel { font:12px Arial,Helvetica,sans-serif;}';css+='#'+this.name+' .panel .outer { position:relative; border:0;background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll left top transparent; }';css+='#'+this.name+' .panel .page #goBtn { border:1px solid #d5bd98; border-right-color:#935e0d; border-bottom-color:#935e0d; background:#ffa822 url("https://www.paypalobjects.com/en_US/i/pui/core/btn_bg_sprite.gif") left 17.5% repeat-x; cursor:pointer; font:12px Arial,Helvetica,sans-serif; margin-top:10px;}';css+='#'+this.name+' .panel .page #goBtn span {margin:5px;}';css+='#'+this.name+' .panel .outer .page { background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll right top transparent; margin-left:  15px; padding: 10px 10px 0 0; position:relative; min-height: 290px; left:17px; }';css+='#'+this.name+' .panel .outer .page .launcher { padding:0 0 20px 0; width:315px!important; }';css+='#'+this.name+' .panel .outer .page .launcher .logoPara { text-align:right;}';css+='#'+this.name+' .panel .outer .page .launcher .continueText { padding-right:10px;}';css+='#'+this.name+' .panel .minifooter {background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll right bottom transparent; position: absolute;  width:80%; height:12px; right:0px}';css+='#'+this.name+' .panel .outer .minifootercap {background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll left bottom transparent; left: -32px; position: absolute; height: 12px; width:80%;}';css+='#'+this.name+' .panel #closer{ top:-10px; right:0; position:absolute;}';css+='#'+this.name+' .panel #closer a{margin:0; padding:0; list-style:none;  text-decoration:none; position:absolute; height:26px; display:block; width:26px; background:url("https://www.paypal.com/en_US/i/btn/btn_dg_close_sprite.png");cursor:pointer;}';css+='#'+this.name+' .panel #closer a:hover{background: url("https://www.paypal.com/en_US/i/btn/btn_dg_close_sprite.png") -26px 0;}';}
styleEl.type='text/css';styleEl.id='dgCSS';if(styleEl.styleSheet){styleEl.styleSheet.cssText=css;}else{styleEl.appendChild(document.createTextNode(css));}
document.getElementsByTagName('head')[0].appendChild(styleEl);},_buildDOM:function(){this.UI.wrapper=document.createElement('div');this.UI.wrapper.id=this.name;this.UI.panel=document.createElement('div');this.UI.panel.className='panel';try{this.UI.iframe=document.createElement('<iframe name="'+this.name+'">');}catch(e){this.UI.iframe=document.createElement('iframe');this.UI.iframe.name=this.name;}
this.UI.iframe.frameBorder='0';this.UI.iframe.border='0';this.UI.iframe.scrolling='no';this.UI.iframe.allowTransparency='true';this.UI.mask=document.createElement('div');this.UI.mask.className='mask';this.UI.panel.appendChild(this.UI.iframe);this.UI.wrapper.appendChild(this.UI.mask);this.UI.wrapper.appendChild(this.UI.panel);document.body.appendChild(this.UI.wrapper);},_buildDOMMB:function(){this.UI.wrapper=document.createElement('div');this.UI.wrapper.id=this.name;this.UI.panel=document.createElement('div');this.UI.panel.className='panel';this.UI.mask=document.createElement('div');this.UI.mask.className='mask';this.UI.outer=document.createElement('div');this.UI.outer.className='outer';this.UI.page=document.createElement('div');this.UI.page.className='page';this.UI.closer=document.createElement('div');this.UI.closer.id='closer';this.UI.closerImg=document.createElement('a');this.UI.closerImg.src='#';this.UI.launcher=document.createElement('div');this.UI.launcher.className='launcher';this.UI.loadingPara=document.createElement('p');this.UI.loadingPara.className='continueText';this.UI.loadingText=document.createTextNode("Please continue your purchase in the secure window we opened. If you don't see it, click the button below.");this.UI.goBtn=document.createElement('button');this.UI.goBtn.id='goBtn';this.UI.goBtn.value='Go';this.UI.goBtn.innerHTML='<span>Go</span>';this.UI.goBtn.className='button primary';this.UI.logoPara=document.createElement('p');this.UI.logoPara.className='logoPara';this.UI.logoImg=document.createElement('img');this.UI.logoImg.alt='logo';this.UI.logoImg.src='https://www.paypal.com/en_US/i/logo/logo_paypal_140wx50h.gif';this.UI.logoImg.className='logo';this.UI.minifooter=document.createElement('div');this.UI.minifooter.className='minifooter';this.UI.minifooter.id='minifooter';this.UI.minifootercap=document.createElement('div');this.UI.minifootercap.className='minifootercap';this.UI.minifootercap.id='minifootercap';this.UI.wrapper.appendChild(this.UI.mask);this.UI.wrapper.appendChild(this.UI.panel);document.body.appendChild(this.UI.wrapper);this.UI.panel.appendChild(this.UI.outer);this.UI.outer.appendChild(this.UI.page);this.UI.page.appendChild(this.UI.launcher);this.UI.outer.appendChild(this.UI.closer);this.UI.closer.appendChild(this.UI.closerImg);this.UI.launcher.appendChild(this.UI.logoPara);this.UI.logoPara.appendChild(this.UI.logoImg);this.UI.loadingPara.appendChild(this.UI.loadingText);this.UI.launcher.appendChild(this.UI.loadingPara);this.UI.launcher.appendChild(this.UI.goBtn);this.UI.page.appendChild(this.UI.minifooter);this.UI.page.appendChild(this.UI.minifootercap);},_createMask:function(e){var windowWidth,windowHeight,scrollWidth,scrollHeight,width,height;var actualWidth=(document.documentElement)?document.documentElement.clientWidth:window.innerWidth;if(window.innerHeight&&window.scrollMaxY){scrollWidth=actualWidth+window.scrollMaxX;scrollHeight=window.innerHeight+window.scrollMaxY;}else if(document.body.scrollHeight>document.body.offsetHeight){scrollWidth=document.body.scrollWidth;scrollHeight=document.body.scrollHeight;}else{scrollWidth=document.body.offsetWidth;scrollHeight=document.body.offsetHeight;}
if(window.innerHeight){windowWidth=actualWidth;windowHeight=window.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowWidth=document.documentElement.clientWidth;windowHeight=document.documentElement.clientHeight;}else if(document.body){windowWidth=document.body.clientWidth;windowHeight=document.body.clientHeight;}
width=(windowWidth>scrollWidth)?windowWidth:scrollWidth;height=(windowHeight>scrollHeight)?windowHeight:scrollHeight;this.UI.mask.style.width=width+'px';this.UI.mask.style.height=height+'px';},_centerLightbox:function(e){var width,height,scrollY;if(window.innerWidth){width=window.innerWidth;height=window.innerHeight;scrollY=window.pageYOffset;}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){width=document.documentElement.clientWidth;height=document.documentElement.clientHeight;scrollY=document.documentElement.scrollTop;}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){width=document.body.clientWidth;height=document.body.clientHeight;scrollY=document.body.scrollTop;}
if((this.expType=="instant"&&!this.RMC)||this.expType=="mini"){var panelWidth=355,panelHeight=300;this.UI.launcher.style.width=panelWidth+"px";this.UI.launcher.style.height=panelHeight+"px";this.UI.panel.style.left=Math.round((width-panelWidth)/2)+'px';var panelTop=Math.round((height-550)/2)+scrollY+20;}else{this.UI.panel.style.left=Math.round((width-this.UI.iframe.offsetWidth)/2)+'px';var panelTop=Math.round((height-this.UI.iframe.offsetHeight)/2)+scrollY;}
if(panelTop<5){panelTop=10;}
this.UI.panel.style.top=panelTop+'px';},_bindEvents:function(){addEvent(window,'resize',this._createMask,this);addEvent(window,'resize',this._centerLightbox,this);addEvent(window,'unload',this._destroy,this);},_setTrigger:function(el){if(el.constructor.toString().indexOf('Array')>-1){for(var i=0;i<el.length;i++){this._setTrigger(el[i]);}}else{el=(typeof el=='string')?document.getElementById(el):el;if(el&&el.form){el.form.target=this.name;}else if(el&&el.tagName.toLowerCase()=='a'){el.target=this.name;}
addEvent(el,'click',this._triggerClickEvent,this);}},_getImage:function(url,callback){if(typeof this.callback!='undefined'){url=this.url;callback=this.callback;}
var self=this;var imgElement=new Image();imgElement.src="";if(imgElement.readyState){imgElement.onreadystatechange=function(){if(imgElement.readyState=='complete'||imgElement.readyState=='loaded'){callback(imgElement,self);}};}else{imgElement.onload=function(){callback(imgElement,self);};}
imgElement.src=url;},_addImage:function(img,obj){if(checkEmptyImage(img)){obj.RMC=true;var url="https://"+obj.stage+"/webapps/checkout/clearNob.gif";var wrapperObj={};wrapperObj.callback=obj._removeImage;wrapperObj.url=url;wrapperObj.outer=obj;var el=obj.trigger;if(el!=null){if(el.constructor.toString().indexOf('Array')>-1){for(var i=0;i<el.length;i++){var tempImg=img.cloneNode(true);obj._placeImage(el[i],tempImg,wrapperObj);}}else{obj._placeImage(el,img,wrapperObj);}}}},_placeImage:function(el,img,obj){el=(typeof el=='string')?document.getElementById(el):el;var root=getParent(el);var spanElement=document.createElement("span");spanElement.className="nameOnButton";var lineBreak=document.createElement("br");var link=document.createElement("a");link.href="javascript:";link.appendChild(img);root.insertBefore(spanElement,el);spanElement.appendChild(el);spanElement.insertBefore(link,el);spanElement.insertBefore(lineBreak,el);obj.span=spanElement;obj.link=link;obj.lbreak=lineBreak;addEvent(link,'click',obj.outer._getImage,obj);},_removeImage:function(img,obj){if(!checkEmptyImage(img)){var el=obj.outer.trigger;if(el.constructor.toString().indexOf('Array')>-1){obj.outer._removeMultiImages(obj.outer.trigger);}else{spanElement=obj.span;link=obj.link;lineBreak=obj.lbreak;spanElement.removeChild(link);spanElement.removeChild(lineBreak);}}},_removeMultiImages:function(obj){for(var i=0;i<obj.length;i++){obj[i]=(typeof obj[i]=='string')?document.getElementById(obj[i]):obj[i];rootNode=getParent(obj[i]);if(rootNode.className=='nameOnButton'){lineBreak=getPreviousSibling(obj[i]);linkNode=getPreviousSibling(lineBreak);rootNode.removeChild(linkNode);rootNode.removeChild(lineBreak);}}},_triggerClickEvent:function(e){this._render();},_destroy:function(e){if(typeof this.dgWindow=='object'){try{this.dgWindow.close();}catch(er){}}
if(document.getElementById('PPDGFrame')){var parentDiv=document.getElementById('PPDGFrame').parentNode;parentDiv.removeChild(document.getElementById('PPDGFrame'));}
if(this.isOpen&&this.UI.wrapper.parentNode){this.UI.wrapper.parentNode.removeChild(this.UI.wrapper);}
if(this.interval){clearInterval(this.interval);}
removeEvent(window,'resize',this._createMask);removeEvent(window,'resize',this._centerLightbox);removeEvent(window,'unload',this._destroy);removeEvent(window,'message',this._windowMessageEvent);this.isOpen=false;}};var eventCache=[];function addEvent(obj,type,fn,scope){scope=scope||obj;var wrappedFn;if(obj){if(obj.addEventListener){wrappedFn=function(e){fn.call(scope,e);};obj.addEventListener(type,wrappedFn,false);}else if(obj.attachEvent){wrappedFn=function(){var e=window.event;e.target=e.target||e.srcElement;e.preventDefault=function(){window.event.returnValue=false;};fn.call(scope,e);};obj.attachEvent('on'+type,wrappedFn);}}
eventCache.push([obj,type,fn,wrappedFn]);}
function removeEvent(obj,type,fn){var wrappedFn,item,len,i;for(i=0;i<eventCache.length;i++){item=eventCache[i];if(item[0]==obj&&item[1]==type&&item[2]==fn){wrappedFn=item[3];if(wrappedFn){if(obj.removeEventListener){obj.removeEventListener(type,wrappedFn,false);}else if(obj.detachEvent){obj.detachEvent('on'+type,wrappedFn);}}}}}
function getParent(el){do{el=el.parentNode;}
while(el&&el.nodeType!=1);return el;}
function getPreviousSibling(el){do{el=el.previousSibling;}
while(el&&el.nodeType!=1);return el;}
function checkEmptyImage(img){return(img.width>1||img.height>1);}}());(function(a){a.tiny=a.tiny||{};a.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false}};a.fn.tinyscrollbar=function(d){var c=a.extend({},a.tiny.scrollbar.options,d);this.each(function(){a(this).data("tsb",new b(a(this),c))});return this};a.fn.tinyscrollbar_update=function(c){return a(this).data("tsb").update(c)};function b(q,g){var k=this,t=q,j={obj:a(".viewport",q)},h={obj:a(".overview",q)},d={obj:a(".scrollbar",q)},m={obj:a(".track",d.obj)},p={obj:a(".thumb",d.obj)},l=g.axis==="x",n=l?"left":"top",v=l?"Width":"Height",r=0,y={start:0,now:0},o={},e="ontouchstart" in document.documentElement;function c(){k.update();s();return k}this.update=function(z){j[g.axis]=j.obj[0]["offset"+v];h[g.axis]=h.obj[0]["scroll"+v];h.ratio=j[g.axis]/h[g.axis];d.obj.toggleClass("disable",h.ratio>=1);m[g.axis]=g.size==="auto"?j[g.axis]:g.size;p[g.axis]=Math.min(m[g.axis],Math.max(0,(g.sizethumb==="auto"?(m[g.axis]*h.ratio):g.sizethumb)));d.ratio=g.sizethumb==="auto"?(h[g.axis]/m[g.axis]):(h[g.axis]-j[g.axis])/(m[g.axis]-p[g.axis]);r=(z==="relative"&&h.ratio<=1)?Math.min((h[g.axis]-j[g.axis]),Math.max(0,r)):0;r=(z==="bottom"&&h.ratio<=1)?(h[g.axis]-j[g.axis]):isNaN(parseInt(z,10))?r:parseInt(z,10);w()};function w(){var z=v.toLowerCase();p.obj.css(n,r/d.ratio);h.obj.css(n,-r);o.start=p.obj.offset()[n];d.obj.css(z,m[g.axis]);m.obj.css(z,m[g.axis]);p.obj.css(z,p[g.axis])}function s(){if(!e){p.obj.bind("mousedown",i);m.obj.bind("mouseup",u)}else{j.obj[0].ontouchstart=function(z){if(1===z.touches.length){i(z.touches[0]);z.stopPropagation()}}}if(g.scroll&&window.addEventListener){t[0].addEventListener("DOMMouseScroll",x,false);t[0].addEventListener("mousewheel",x,false);t[0].addEventListener("MozMousePixelScroll",function(z){z.preventDefault()},false)}else{if(g.scroll){t[0].onmousewheel=x}}}function i(A){a("body").addClass("noSelect");var z=parseInt(p.obj.css(n),10);o.start=l?A.pageX:A.pageY;y.start=z=="auto"?0:z;if(!e){a(document).bind("mousemove",u);a(document).bind("mouseup",f);p.obj.bind("mouseup",f)}else{document.ontouchmove=function(B){B.preventDefault();u(B.touches[0])};document.ontouchend=f}}function x(B){if(h.ratio<1){var A=B||window.event,z=A.wheelDelta?A.wheelDelta/120:-A.detail/3;r-=z*g.wheel;r=Math.min((h[g.axis]-j[g.axis]),Math.max(0,r));p.obj.css(n,r/d.ratio);h.obj.css(n,-r);if(g.lockscroll||(r!==(h[g.axis]-j[g.axis])&&r!==0)){A=a.event.fix(A);A.preventDefault()}}}function u(z){if(h.ratio<1){if(g.invertscroll&&e){y.now=Math.min((m[g.axis]-p[g.axis]),Math.max(0,(y.start+(o.start-(l?z.pageX:z.pageY)))))}else{y.now=Math.min((m[g.axis]-p[g.axis]),Math.max(0,(y.start+((l?z.pageX:z.pageY)-o.start))))}r=y.now*d.ratio;h.obj.css(n,-r);p.obj.css(n,y.now)}}function f(){a("body").removeClass("noSelect");a(document).unbind("mousemove",u);a(document).unbind("mouseup",f);p.obj.unbind("mouseup",f);document.ontouchmove=document.ontouchend=null}return c()}}(jQuery));/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($){$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value===null||value===undefined)){options=$.extend({},options);if(value===null||value===undefined){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=String(value);return(document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||{};var decode=options.raw?function(s){return s;}:decodeURIComponent;var pairs=document.cookie.split('; ');for(var i=0,pair;pair=pairs[i]&&pairs[i].split('=');i++){if(decode(pair[0])===key)return decode(pair[1]||'');}
return null;};})(jQuery);/*chunk_global*/$(function(){$("#page_pCoolrLogo").click(function(){window.location.href=domainPath;});$(".launchPcoolr, .launchEditor, .launchEditor1").click(function(e){e.preventDefault();var state=$(this).attr('id').split('_')[1];window.location.href=domainPath+'/#'+state;});$("#signed").hover(function(){$(this).fadeTo(200,1);$("#projectsLink").fadeIn();},function(){$(this).fadeTo(200,.6);$("#projectsLink").fadeOut();});$(".donateLink").click(function(e){e.preventDefault();});$(".clickClear").click(function(){var v=$(this).val();if(v=='Search patterns'||v=='Email'||v=='Password'||v=='Username')$(this).val('');$(this).css({color:'#000'});});$(".gotIt").click(function(){$.cookie("partnerMsg0",'gotIt',{expires:300});$(this).parent().fadeOut();});});var ms_ie=false;var ua=window.navigator.userAgent;var old_ie=ua.indexOf('MSIE ');var new_ie=ua.indexOf('Trident/');if((old_ie>-1)||(new_ie>-1)){ms_ie=true;}
function makeSlug(name){if(name){var slug=name.replace(/[ +-]/g,"_");slug=slug.replace(/[^a-zA-Z0-9_]/g,"").toLowerCase();return slug;}}
function alertBar(htmlMsg,msgType){clearTimeout(fadeAlertBarTimer);var r=msgType=='success'?'error':'success';$("#alertBar").addClass(msgType).removeClass(r).fadeIn().html(htmlMsg);fadeAlertBarTimer=setTimeout(function(){$("#alertBar").fadeOut(1000);},4000);}
function capitaliseFirst(string)
{return string.charAt(0).toUpperCase()+string.slice(1);}
function blackOutMsg(msg,loader,btnMsg,okCallback,okArg,cancel,launchHome){$("#blackOutMsgOkBtn, #blackOutMsgCancelBtn, #blackOutMsgLoader").css({display:'none'});if(msg==undefined||msg==''){$("#blackOut1").css({'z-index':30});if(!($("#downloadHistory_container").is(":visible")||$("#subscription_container").is(":visible")))$("#blackOut1").fadeOut();$("#blackOutMsgContainer").css({'z-index':31}).fadeOut();$("#blackOutMsg").html('');}else{if(launchHome)msg=msg+'<br /><br /><div  class="btn1 launchEditor" id="launch_" onclick="window.location.href = \''+domainPath+'\';">Launch Patterncooler</div>';if(loader)$("#blackOutMsgLoader").css({display:'block'});if(btnMsg){$("#blackOutMsgOkBtn").html(btnMsg).css({display:'block'}).click(function(){okCallback(okArg);blackOutMsg();});}
if(cancel){$("#blackOutMsgCancelBtn").css({display:'block'}).click(function(){blackOutMsg();});}
$("#blackOutMsg").html(msg).css({display:'block'});$("#blackOut1").css({'z-index':100}).fadeIn();$("#blackOutMsgContainer").css({'z-index':101}).fadeIn();}}/*chunk_signIn*/var showRegister=false;$(function(){$("#mergeColors").click(function(){mergeSavedColors();});$("#headerSignInBtn, .signInLink").click(function(){submitSignIn('account');showSignInBar();});$(".registerLink").click(function(){submitSignIn('register');showSignInBar();});$("#closeSignInBar").click(function(){closeSignInBar();blackOutMsg();});$(".socialSignInSubmit").click(function(){var authProvider=$(this).attr('id').split('_')[1];window.location=stagePath+'/?auth='+authProvider+'#'+currentStateString;});$("#username, #password, #registerEmail").keypress(function(e){if(e.which==13){submitSignIn(false);}});$(".signInSubmit").click(function(e){e.preventDefault();var auth=$(this).attr('id').split('_')[1];submitSignIn(auth);});$("#forgotPass").click(function(){$("#forgetPasswordContainer").fadeIn();$("#signInHeader").text("Reset password");});$("#cancelFP").click(function(){$("#forgetPasswordContainer").fadeOut();$("#signInHeader").text("Sign in");});$("#rememberCheckBox").click(function(){if($("#rememberMe").val()==1){$("#rememberCheckBox").css({'background-position':'50% 0%'});$("#rememberMe").val(0);}
else{$("#rememberCheckBox").css({'background-position':'50% 100%'});$("#rememberMe").val(1);}});$("#signOutMenuLink").click(function(){$.ajax({url:"apiSignIn.php?",type:"POST",success:function(data){if(data=='signedOut'){userName=0;userID=0;authProvider=0;userSavedColorsArray=[];userSavedPatternsArray=[];savedColorsArray=cachedSavedColorsArray;signedInOut(0);$.cookie("pcoolrRemember",0,{expires:300});location.reload();}},data:{authProvider:'signOut'},dataType:"html"});});$("#resetPassword").click(function(){var emailVar=$("#forgetPWemail").val();$.ajax({url:"apiSignIn.php?",type:"POST",success:function(data){var dataArray=data.split(',');if(dataArray[0]=='success'){blackOutMsg("A link has been sent to your email address. Follow this link to change your password - Try checking your spam filter if it doesn't appear in your inbox within the next few minutes");}else{$("#signInErrorMsg").html(data).fadeOut(1).fadeIn();blackOutMsg("A link has been sent to your email address. Follow this link to change your password - Try checking your spam filter if it doesn't appear in your inbox within the next few minutes");}},data:{authProvider:'sendPassword',registerEmail:emailVar},dataType:"html"});});});function submitSignIn(auth){var authProvider=null;if(auth)authProvider=auth;else authProvider=$("#registerEmail").is(":visible")?'register':'account';var submit=true;var errorMsgStr='';if((authProvider=='register'&&showRegister==true)||(authProvider=='account'&&showRegister==false)){var valErrorArray=[];var ck_username=/^[A-Za-z0-9_]{5,20}$/;var ck_password=/^[A-Za-z0-9!@#$%^&*()_]{6,20}$/;var ck_email=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;if(!ck_username.test($("#username").val())||$("#username").val()=='Username'){errorMsgStr+="*Username should be between 5 and 20 characters. ";$("#username").css({'border-color':'#FF3F00'});submit=false;}else $("#username").css({'border-color':'#ccc'});if(!ck_password.test($("#password").val())||$("#password").val()=='Password'){errorMsgStr+="*Password should be between 6 and 20 characters. ";$("#password").css({'border-color':'#FF3F00'});submit=false;}else $("#password").css({'border-color':'#ccc'});if(authProvider=='register'){if(!ck_email.test($("#registerEmail").val())||$("#registerEmail").val()=='Email'){errorMsgStr+="*Please enter valid email address.<br>";$("#registerEmail").css({'border-color':'#FF3F00'});submit=false;}else $("#registerEmail").css({'border-color':'#ccc'});}}
if(authProvider=='register'&&showRegister==false){showRegister=true;$("#signInHeader").text("Register");$("#signIn_account").animate({"right":"0px"},"slow",function(){$(this).removeClass('liveBtn');$("#signIn_register").addClass('liveBtn');});$("#regOr").animate({"right":"98px"},"slow");$("#registerEmail").fadeIn();$("#forgotPass").fadeOut();submit=false;errorMsgStr='';}
if(authProvider=='account'&&showRegister==true){showRegister=false;$("#signInHeader").text("Sign in");$("#registerEmail").fadeOut();$("#forgotPass").fadeIn();$("#regOr").animate({"right":"248px"},"slow");$("#signIn_account").animate({"right":"290px"},"slow",function(){$(this).addClass('liveBtn');$("#signIn_register").removeClass('liveBtn');});submit=false;errorMsgStr='';}
if(errorMsgStr!=''){$("#openIDbtns").addClass('trans');$("#signInErrorMsg").html(errorMsgStr).fadeIn();}
if(submit==true){$("#signInVeil").fadeIn();var emailVar=$("#registerEmail").val();var usernameVar=$("#username").val();var passwordVar=$("#password").val();var signInRememberMe=$("#rememberMe").val();$.ajax({url:"apiSignIn.php?",type:"POST",success:function(data){var dataArray=data.split(',');if(dataArray[0]=='success'){$(".loader1").css({display:'none'});userName=dataArray[1];userID=dataArray[2];userLevel=dataArray[5];if(userLevel==9)location.reload();authProvider=dataArray[3];signedInOut(1);closeSignInBar();switchCSS();if(dataArray[3]=='account'){if(!$("#blackOut1").is(":visible")){blackOutMsg('Welcome '+userName+' : )');setTimeout(blackOutMsg,2000);}}
if(dataArray[3]=='register'){if(!$("#blackOut1").is(":visible")){blackOutMsg('Registration success - Welcome '+userName+' : )');setTimeout(blackOutMsg,2000);}}
if(dataArray[4]!=0)$.cookie("pcoolrRemember",dataArray[4],{expires:300});}else{$("#signInVeil").fadeOut();$("#signInErrorMsg").html(data).fadeOut(1).fadeIn();}},data:{authProvider:authProvider,registerEmail:emailVar,username:usernameVar,password:passwordVar,rememberMe:signInRememberMe},dataType:"html"});}else if(errorMsgStr=='')resetSignInForm();}
function showSignInBar(){$("#signIn_container").animate({"top":"0px"},"slow");$("#blackOut1").fadeIn('fast');resetSignInForm();}
function switchCSS(){if(userLevel<=3)$('#cssColor').replaceWith('<link id="cssColor" rel="stylesheet" href="'+stagePath+'/css/color_.css?t='+Date.now()+'"></link>');if(userLevel==3)$('#cssColor').replaceWith('<link id="cssColor" rel="stylesheet" href="'+stagePath+'/css/color_pro.css?t='+Date.now()+'"></link>');if(userLevel>=5)$('#cssColor').replaceWith('<link id="cssColor" rel="stylesheet" href="'+stagePath+'/css/color_com.css?t='+Date.now()+'"></link>');}
function resetSignInForm(){var inputUserName=$('input[name="username"]').val();var inputPassword=$('input[name="password"]').val();var inputEmail=$('input[name="registerEmail"]').val();$(".loginInput").css({'border-color':'#ccc'});$("#openIDbtns").removeClass('trans');$("#signInErrorMsg").html('').css({display:'none'});$("#signInSuccessMsg").html('').css({display:'none'});$("#rememberCheckBox").css({'background-position':'50% 100%'});$("#rememberMe").val(1);}
function signedInOut(state){if(state==1){$("#select_UserOptions").css({display:'block'});$("#userName").text(userName);setUserState();$("#userName").text(userName);$("#headerSignInBtn").addClass('hide');if($("#downloadSignedOut").is(":visible"))$("#downloadSignedIn").fadeIn();if($("#subscribeSignedOut").is(":visible"))$("#subscribeSignedIn").fadeIn();$("#downloadSignedOut, #subscribeSignedOut").css({display:'none'});if($("#connectToPaypal_container").is(":visible"))checkout();applyUserData();}else{userLevel=1;$("#select_UserOptions").css({display:'none'});$("userName").text('');setUserState();$("#headerSignInBtn").removeClass('hide');$("#userColors").empty();$("#userSavedPatterns").empty();$("#downloadSignedOut").css({display:'block'});$("#downloadSignedIn").css({display:'none'});setSaveText();}}
function setUserState(){var userTypeTxt='';var licenseStr=''
if(partner==''){if(userLevel<3){userTypeTxt='FREE';maxTileSize=300;}
if(userLevel==3){userTypeTxt='Professional';maxTileSize=2000;}
if(userLevel==5){userTypeTxt='Commercial';maxTileSize=4000;}
if(userLevel==9){userTypeTxt='Admin';maxTileSize=15000;}}else userTypeTxt='FREE';if(userLevel<3){$("#subscribe_infoBox").fadeIn();licenseStr='License options';$("#userTypeTxt").text('Welcome');$("#freeDownloads").html(userTypeTxt+'<span> up to '+maxTileSize+'px by '+maxTileSize+'px</span>');}else{licenseStr=userTypeTxt+' license included';$("#userTypeTxt").text(userTypeTxt);$("#freeDownloads").html(userTypeTxt+'<span> < '+maxTileSize+'px</span>');}
if(userLevel==3)$(".subLink").html('Upgrade to commercial');else $(".subLink").html('<b>UNLIMITED</b> high-res downloads');if(userLevel==5)$("#subscribe_infoBox").fadeOut();else $("#subscribe_infoBox").fadeIn();$("#download_licenseType").text(licenseStr);$("#patternSizeSlider, #downloadPatternSizeSlider").slider('option','max',maxTileSize);if(tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]>maxTileSize){changeTileSize(maxTileSize,0);$("#patternSizeSlider, #downloadPatternSizeSlider").slider('value',maxTileSize);}
if(userLevel>=5){$("#svg").css({display:'block'});$(".formatsAvailable").css({display:'inline'});}else $(".formatsAvailable, #svg").css({display:'none'});defaultMaxW=maxTileSize;defaultMaxH=maxTileSize;if(document.sizeInput.areaWidth.value>maxTileSize)document.sizeInput.areaWidth.value=maxTileSize;if(document.sizeInput.areaHeight.value>maxTileSize)document.sizeInput.areaHeight.value=maxTileSize;if(editorLoaded==true){standardSize(document.sizeInput.areaWidth.value+'x'+document.sizeInput.areaHeight.value);}}
function closeSignInBar(){$("#signIn_container").animate({"top":"-204px"},"slow");$("#signInVeil").css({display:'none'});if(!$("#subscription_container").is(":visible"))$("#blackOut1").fadeOut('fast');}/*chunk_control*/var apiDomainPath='';var defaultMaxW=maxTileSize;var defaultMaxH=maxTileSize;var loggedIn=false;var config={partnerName:'PatternCooler',displayMode:'full',signIn:'min',patternBrowser:'normal',colorEditor:'min',patternViewer:'normal',product:'min',userSave:'min',share:'min',cart:'min'}
var numOfThbRows=3;var page='editor';var vRows=2;var thbW=90;var masterPatArray=[];var masterTextureArray=[];var vPatArray=[];var undoArray=[],undoPos=0;var wW;var cW;var wH;var thbWindowPadding=50;var thbPaneWidth=wW-(2*thbWindowPadding);var numOfThbPanes=0;var currentPane=0;var thbColsPerPane=0;var numOfThbCols=0;var paneViewedArray=[];var thbColPadding=3;var thbCellPadding=0;var headerH=63;var currentVnum=0;var currentVgenHSB=null;var numOfVthbCols=3;var numOfVthbRows=null;var currentVpane=0;var numOfVpanes=0;var vThbPaneWidth=0;var vThbPanesLoaded=0;var numOfVthbs=0;var orderBy='rank';var thbsLoaded=false;var scroll=0;var mouseWheelDelta=0;var cartScrollbar;var userScrollbar;var vThbScrollbar;var subscriptionScrollbar;var minIconW=120;var minViewerH=(partner=='')?332:partnerMinViewerH;var panelView='product';var currentTextureTile=null;var currentDownload;var currentDownloadAsset;var currentDownloadID;var downloadFormat='svg';var productOffsetX=0;var productOffsetY=0;var defaultProduct=2;var productArray=[];var currentProductID=null;var numOfProductCols=0;var currentProductThbPane=1;var currentTransID;var downloadTab='tile';var containerOrderArray=['browser','editor','viewer','share','product','texture'];var containerSizePosArray={};var containerMaxH=730;var fadePreviewControlsTimer;var fadeAlertBarTimer;var sendStateUpdateTimer;var minimisedContainerArray=[];var currentTileType='Patterns';var currentPatternName;var currentPatternAuthor;var currentTextureName;var currentTextureAuthor;var maxTextureSize=500;var minTextureSize=100;var currentStateString='';var vRandomness=0;var updatingPartnerCart=false;var PATARRAY_ID_KEY=0;var PATARRAY_NAME_KEY=1;var PATARRAY_AUTHOR_KEY=2;var PATARRAY_TAGS_KEY=3;var PATARRAY_RANK_KEY=4;var PATARRAY_HEX0_KEY=5;var PATARRAY_HEX1_KEY=6;var PATARRAY_HEX2_KEY=7;var PATARRAY_DATE_KEY=8;var TAGARRAY_ID_KEY=0;var TAGARRAY_TAG_KEY=1;var TAGARRAY_INCIDENCE_KEY=2;var stateStr={tile_width:0,tile_height:0,area_width:0,area_height:0,offset_x:0,offset_y:0,pattern_opacity:0,colors:0,pattern_id:0,texture_id:0,texture_opacity:0,texture_width:0,texture_height:0,product_id:0};var pCoolrRed='#FF3F00';var pCoolrGreen='#7FFF00';var _firstload=true;var launchingFromState=false;var launchedOnce=false;var priceThreshold=1000;var currentProductName;var productOptionObj={};var currentOptionPrice=null;var subParamStr='';function zeroPad(num,size){var s=num+"";while(s.length<size)s="0"+s;return s;}
function loadExternalFile(filePath,filetype){if(filetype=="js"){var fileref=document.createElement('script')
fileref.setAttribute("type","text/javascript")
fileref.setAttribute("src",filePath)}
else if(filetype=="css"){var fileref=document.createElement("link")
fileref.setAttribute("rel","stylesheet")
fileref.setAttribute("type","text/css")
fileref.setAttribute("href",filePath)}
if(typeof fileref!="undefined")document.getElementsByTagName("head")[0].appendChild(fileref);}
function getParamFromURL(param){return false;}
function getStateFromHash(param){var URLhash=window.location.toString().split("#")[1];if(URLhash==undefined||URLhash==''||URLhash==null)return false;else{try{decode(URLhash);return URLhash;}
catch(err){console.log('Bad state string hash in URL');return false;}}}
$(function(){$(window).resize(function(){if($(window).width()!=wW||$(window).height()!=wH){adjustToSreenSize();minimisedContainerArray=[];setContainers();buildThbCells();$("#cartScrollbar > .viewport").css({height:(wH-170)+'px'});cartScrollbar.tinyscrollbar_update();adjustPriceTrack();}});$(".pCoolrLaunch").click(function(){var type=$(this)[0].tagName;if(type=='IMG')var urlStr=$(this).attr('src');if(type=='DIV')var urlStr=$(this).css('background-image');var urlStrArray=urlStr.split('/');var launchStr=urlStrArray[urlStrArray.length-1].split('.')[0];launchPcoolr(launchStr);$("#wrapper").fadeIn('slow');$("#boxBlackOut").fadeIn('slow');});$("#patternSizeSlider").slider({animate:true,range:"min",value:250,min:minTileSize,max:maxTileSize,step:1,slide:function(event,ui){changeTileSize(ui.value,0,'preview');}});var patternSizeHandle=$("#patternSizeSlider .ui-slider-handle");patternSizeHandle.html('Pattern size');var patternSizeBubbleDiv=$('<div>',{id:'patternSizeBubble','class':'sizeBubble bubble'});patternSizeHandle.append(patternSizeBubbleDiv);var patternSubBoxDiv=$('<div>',{id:'floatingSubBox'});var subBoxHTML=$("#subscriptionBox").html();patternSubBoxDiv.html(subBoxHTML);patternSubBoxDiv.css({display:'none'});patternSizeHandle.append(patternSubBoxDiv);$("#patternSizeSliderContainer, .infoBox").hover(function(){var node=$(this).attr('id');if(node=='patternSizeSliderContainer'){$("#subscribe_infoBox > .infoBoxFader").stop().fadeIn();}
else $(this).children(":first").stop().fadeIn();},function(){var node=$(this).attr('id');if(node=='patternSizeSliderContainer'){$("#subscribe_infoBox > .infoBoxFader").stop().fadeOut();$(".subLink").stop().fadeIn(200);}
else $(this).children(":first").stop().fadeOut();});$(".openEmbed").click(function(){window.location.href='http://pattern.co/patterncooler/embed'});$("#downloadPatternSizeSlider").slider({animate:true,range:"min",value:250,min:minTileSize,max:maxTileSize,step:1,slide:function(event,ui){changeTileSize(ui.value,0,'area');}});$("#downloadPatternSizeSlider .ui-slider-handle").html('Pattern size');$("#downloadTextureSizeSlider").slider({animate:true,range:"min",value:250,min:minTextureSize,max:maxTextureSize,step:1,slide:function(event,ui){changeTileSize(ui.value,1,'area');}});$("#downloadTextureSizeSlider .ui-slider-handle").html('Texture size');$("#downloadPatternSizeSlider, #downloadTextureSizeSlider").bind("slidestop",function(event,ui){resetGenBtn();});$("#textureSizeSlider").slider({animate:true,range:"min",value:250,min:minTextureSize,max:maxTextureSize,step:1,slide:function(event,ui){changeTileSize(ui.value,1,'preview');}});var textureSizeHandle=$("#textureSizeSlider .ui-slider-handle");textureSizeHandle.html('Texture size');var textureSizeBubbleDiv=$('<div>',{id:'textureSizeBubble','class':'sizeBubble bubble'});textureSizeHandle.append(textureSizeBubbleDiv);$("#patternOpacitySlider").slider({animate:true,range:"min",value:100,min:0,max:100,step:1,slide:function(event,ui){changeTileOpacity(ui.value,0);}});var patternOpacityHandle=$("#patternOpacitySlider .ui-slider-handle")
patternOpacityHandle.html('Pattern opacity');var patternOpacityBubbleDiv=$('<div>',{id:'patternOpacityBubble','class':'opacityBubble bubble'});patternOpacityHandle.append(patternOpacityBubbleDiv);$("#textureOpacitySlider").slider({animate:true,range:"min",value:50,min:0,max:100,step:1,slide:function(event,ui){changeTileOpacity(ui.value,1);}});var textureOpacityHandle=$("#textureOpacitySlider .ui-slider-handle")
textureOpacityHandle.html('Texture opacity');var textureOpacityBubbleDiv=$('<div>',{id:'textureOpacityBubble','class':'opacityBubble bubble'});textureOpacityHandle.append(textureOpacityBubbleDiv);$("#textureOpacitySlider, #patternOpacitySlider, #textureSizeSlider, #patternSizeSlider").bind("slidestop",function(event,ui){updateStateStr('size and opacity sliders');});$("#vRandomSlider").slider({animate:true,range:"min",value:0,min:0,max:2,step:1,slide:function(event,ui){vRandomness=ui.value;}});$("#vRandomSlider .ui-slider-handle").html('Randomness');$("#vColorSaturationSlider").slider({animate:true,range:"min",value:0.5,min:0,max:1,step:0.25,slide:function(event,ui){buildColorSelector(ui.value);}});$("#vColorSaturationSlider .ui-slider-handle").html('Saturation');$("#vColorSaturationSlider, #vRandomSlider").bind("slidestop",function(event,ui){getVthbs(null,null,'refresh');});$("#vGenBtn").click(function(){openVthbPane(currentLiveVnum);});vThbScrollbar=$('#vThbScroller');vThbScrollbar.tinyscrollbar();userScrollbar=$('#userScrollbar');userScrollbar.tinyscrollbar();cartScrollbar=$('#cartScrollbar');cartScrollbar.tinyscrollbar();downloadHistoryScrollbar=$('#downloadHistoryScrollbar');downloadHistoryScrollbar.tinyscrollbar();subscriptionScrollbar=$('#subscriptionScrollbar');subscriptionScrollbar.tinyscrollbar();$("#colrPickr").mouseup(function(){updateStateStr('colorPicker');});$("#thbNavNext").click(function(){moveThbPane(1);});$("#thbNavPrev").click(function(){moveThbPane(-1);});$('#thbContainer').mousewheel(function(event,delta){var mouseWheelSensitivity=4;if((mouseWheelDelta<0&&delta>0)||(mouseWheelDelta>0&&delta<0)||Math.abs(mouseWheelDelta)>mouseWheelSensitivity)mouseWheelDelta=0;mouseWheelDelta=mouseWheelDelta+delta;if(Math.abs(mouseWheelDelta)==mouseWheelSensitivity){moveThbPane(-1*(delta));mouseWheelDelta=0;}
return false;});$(".thbSizeButt").click(function(){$(".thbSizeButt").removeClass('sizeSelected');$(this).addClass('sizeSelected');thbW=parseInt($(this).attr('id').substring(8));thbCellPadding=thbW/30;buildThbCells();});$(".orderByButt").click(function(){orderBy=$(this).attr('id');if(orderBy=='rank')$("#selectedOrder").html('Popular');if(orderBy=='date')$("#selectedOrder").html('New');if(orderBy=='patID')$("#selectedOrder").html('ID');buildThbCells();});$("#showAllTags").click(function(){showAll();});$(".tagCloudLink").click(function(e){e.preventDefault();window.location.href=$(this).attr("href")+'-#'+currentStateString;$("#tagCloud").fadeOut();});$("#tagCloud").hover(function(){},function(){$("#tagCloud").fadeOut();});$("#showTagCloud").click(function(){$("#tagCloud").fadeIn();});$(".formatLink").click(function(){var format=$(this).attr('id');if(downloadTab=='tile')setFormat(format,true);else setFormat(format);});$(".openLightBox, .donateLink").click(function(e){e.stopPropagation();var content=$(this).attr('id').split('_')[0];$(".lightBoxContent").css({display:'none'});$("#content_"+content).css({display:'block'});$("#blackOut").fadeIn('fast',function(){document.getElementById('lightBox_container').style.display='block';if(content=='download'){download();$("#downloadHistory_container, #content_donate").css({display:'none'});}
if(content=='donate')$("#content_donate").css({'background':'#fff'});});});$(".bigClose, #lightBox_container-close2, #lightBox_container-back").click(function(){var containerId=$(this).attr('id').split('-')[0];closeContainer(containerId);});$("#preview").click(function(){closeContainer('editor_container');closeContainer('texture_container');closeContainer('cart_container');closeContainer('downloadHistory_container');});$(".tab").click(function(){var tabIdArray=$(this).attr('id').split('_');changeTab(tabIdArray[0],tabIdArray[2],'click');});$(".fullScreen").click(function(){var contID=$(this).attr('id').split('_')[1];sizeContainer(contID,'full');});$(".restoreScreen").click(function(){var contID=parseInt($(this).attr('id').split('_')[1]);var caller=$(this).attr('id').split('_')[0];restoreContainer(contID,caller);});$("#preview").mousemove(function(){if($("#hidePreviewControls").css('display')=='none'){$("#hidePreviewControls").fadeIn();$("#pCoolrMaskLayer").fadeOut();if(containerSizePosArray[1][5]=='full')fadePreviewControlsTimer=setTimeout(function(){$("#hidePreviewControls").fadeOut(1000);if(tilePrice>0)$("#pCoolrMaskLayer").fadeIn(1000);},3000);}});$(".launchContainerBtn").click(function(){var btnID=$(this).attr('id');var contArray=btnID.split('_');var contID=contArray[1];var contName=contArray[2];var contTab=contArray[3];if(!(contName=='cart'&&cartArray.length==0)){if(contName=='editor'){$("#editor_container").css({top:containerSizePosArray[0][4]+'px'});changeTab('edit',contTab);}else{containerSizePosArray[contID][5]='normal';$("#"+contName+"_container").css({display:'block'});}
sortContainers(contName,'click');}});$("#vColorRefresh").click(function(){getVthbs(null,null,'refresh');});$(".clickToFront").click(function(){sortContainers($(this).attr('id').split('_')[0],'click');});$(".hoverToFront").hover(function(){sortContainers($(this).attr('id').split('_')[0],'hoverIn');},function(){sortContainers($(this).attr('id').split('_')[0],'hoverOut');});$(".doBtn").click(function(e){handleUndoRedo($(this).attr('id'));});$("#saveBtn").click(function(e){savePat();});$("#actionBox_container, .doBtn, #saveBtn, .launchContainerBtn").click(function(e){e.stopPropagation();});$("#vThbContainer").hover(function(){},function(){$(this).fadeOut();});$("#myThemesContainer").hover(function(){userScrollbar.tinyscrollbar_update();},function(){});$(".clickToFront").draggable({cancel:"#prodOp, #ppQuantity, #colorBoxContainer, #shuffleSelect, #editorSVGcontainer, #vThbScroller, #cartScrollbar, #userScrollbar, #textureSizeSliderContainer, #textureOpacitySliderContainer"});$("#keepColors_checkBox").click(function(){if(keepColors==false){$("#keepColors_checkBox").css({'background-position':'50% 100%'});$("#keepColorsPalette").animate({height:'34px'});keepColors=true;keepPalette();}
else{$("#keepColors_checkBox").css({'background-position':'50% 0%'});$("#keepColorsPalette").animate({height:'0px'});keepColors=false;}});$("#checkSeamless").hover(function(){$("#checkerSeamlessBG").css({'background-image':'url('+currentDownload+')','background-repeat':'repeat'});$("#checkerSeamlessBG").fadeIn('slow');$("#downloadTile").fadeOut('slow');},function(){$("#checkerSeamlessBG").fadeOut('slow');$("#downloadTile").fadeIn('slow');});$(".select").hover(function(){},function(){var selectID=$(this).attr('id').split('_')[1];$("#show"+selectID+"Menu").fadeOut();});$(".select").click(function(){var selectID=$(this).attr('id').split('_')[1];if(selectID!='Content')$("#show"+selectID+"Menu").fadeToggle();else $("#show"+selectID+"Menu").fadeIn();});$('.contentLink').click(function(){if($(this).height()>25){$(this).animate({"height":"25px"},"slow",function(){$(this).removeClass('openContent').addClass('closedContent');});}
else{if(!$(this).hasClass('openSub')){$('.contentLink').not(this).each(function(){$(this).animate({"height":"25px"},"slow",function(){$(this).removeClass('openContent').addClass('closedContent');});});$(this).animate({"height":wH-250+"px"},"slow").removeClass('closedContent').addClass('openContent');}}});$("#generateArea").click(function(e){e.stopPropagation();generateAreaRaster();});$(".showBtn").click(function(){var layer=$(this).attr('id').split('_')[1];showHideTileLayer(layer);});$('#searchBox').keydown(function(event){if(event.which==13){event.preventDefault();searchTags();}});$("#searchBtn").click(function(){searchTags();});var activeSocial="social_fb";$(".selectSocial").click(function(){if($(this).attr('id')!=activeSocial){$("#"+activeSocial).stop().css({width:"50px",cursor:'pointer'});$(this).animate({width:"274px"},"slow",function(){$(this).css({cursor:'default'});});activeSocial=$(this).attr('id');}});$("#mergePatterns").click(function(){mergeSavedPatterns();});$("#download_infoLink").click(function(){$("#download_info").toggle();});$("#freePoint").text(priceThreshold/100);$(".openSub").click(function(e){e.preventDefault();e.stopPropagation();$("#blackOut1").fadeIn();$("#subscription_container").css({'z-index':'32'}).fadeIn();subscriptionScrollbar.tinyscrollbar_update();});$("#toLicenseLink").click(function(){subscriptionScrollbar.tinyscrollbar_update(780);});if(navigator.userAgent.indexOf('MSIE')!=-1){$('input').each(function(){var holder=$(this).attr('placeholder');if(typeof(holder)!=='undefined'){$(this).val(holder).css({color:'#999','line-height':'20px'});if(holder=='Password'){$(this).removeAttr("type");$(this).attr('type','text');}
$(this).bind('click',function(){if($(this).val()==holder){if(holder=='Password'){$(this).removeAttr("type");$(this).attr('type','password');}
$(this).val('').css({color:'#000'});}}).blur(function(){if($(this).val()==''){$(this).val(holder).css({color:'#999','line-height':'20px'});if(holder=='Password'){$(this).removeAttr("type");$(this).attr('type','text');}}});}});}});function closeContainer(containerId){if(containerId=='editor_container'){var editorContainerTopPos=$("#"+containerId).css('top').replace("px","");if(editorContainerTopPos!=wH+10){containerSizePosArray[0][4]=editorContainerTopPos;$("#"+containerId).css({top:(wH+10)+'px'});}}else{if(containerId=='lightBox_container'){resetGenBtn();}
$("#"+containerId+", #blackOutMsgContainer").css({display:'none'});if(containerId!='donationAppeal_container'){$("#subscription_container").css({'z-index':'32'});if(!(containerId=='connectToPaypal_container'||containerId=='subscription_container'))$("#blackOut").fadeOut('fast');blackOutMsg();}}}
function moveThbPane(d){var move=false;if(d>0&&currentPane<(numOfThbPanes-1)){currentPane++;$(".thbPane").animate({"left":"-="+thbPaneWidth+"px"},"slow");move=true;}
if(d<0&&currentPane>0){currentPane--;$(".thbPane").animate({"left":"+="+thbPaneWidth+"px"},"slow");move=true;}
if(move==true){shiftScrollNav(currentPane);loadThbPats(currentPane);handleThumbPagination();}}
function handleUndoRedo(doAction){if(undoPos>0&&doAction=='undo'){launchPcoolr(undoArray[undoPos-1],'launchFromHistory');undoPos--;}
if(undoPos<(undoArray.length-1)&&doAction=='redo'){launchPcoolr(undoArray[undoPos+1],'launchFromHistory');undoPos++;}
if(undoPos>0)$("#undo").removeClass('deadDo').addClass('activeDo');else $("#undo").removeClass('activeDo').addClass('deadDo');if(undoPos<(undoArray.length-1))$("#redo").removeClass('deadDo').addClass('activeDo');else $("#redo").removeClass('activeDo').addClass('deadDo');}
function errorBox(msg){$("#blackOut1").fadeIn();$("#blackOutMsg, #blackOutMsgLoader").css({display:'none'});$("#errorMsg").html(msg);$("#errorBox_container").fadeIn();}
function calcPrice(w,h,areaTile){var freeMax=priceThreshold/100;if(areaTile=='tile'){var price=Math.round((parseInt(w)+parseInt(h))*100)/20000;if(price<freeMax&&priceMode==0)price=0;}
if(areaTile=='area'){var price=Math.round((parseInt(w)+parseInt(h))*100)/20000;if(price<freeMax&&priceMode==0)price=5;}
price=0;return price;}
function setFormat(format,fileDownload){if(downloadFormat!=format){resetGenBtn();$(".selectedFormat").text(format.toUpperCase());$("#generateArea").text("Generate "+format.toUpperCase());$("#downloadFile").text("Download "+format.toUpperCase());downloadFormat=format;if(format=='png')$("#recommendFormat").text("Recommended for untextured and transparent patterns");if(format=='jpg')$("#recommendFormat").text("Recommended for patterns with texture");if(format=='svg'){$("#recommendFormat").text("For advanced users wanting a vector format");if(tileLayerArray[1][TILE_OPACITY_KEY]>0)$("#downloadAssetContainer").css({display:'block'});defaultMaxW=9000;defaultMaxH=9000;}else{$("#downloadAssetContainer").css({display:'none'});defaultMaxW=maxTileSize;defaultMaxH=maxTileSize;setupUpdater();}
if(format=='pdf')$("#recommendFormat").text("Recommened for print");if(fileDownload)download(format);}}
function download(format){$("#downloadTileLoader").css({display:'block'});$("#downloadTile").css({background:'transparent'});currentDownload='';if(tileLayerArray[1][TILE_SHOW_KEY]==true){var downloadTileSizeArray=bestFitTexture();var textureApiStr="&TT="+tileLayerArray[1][TILE_OPACITY_KEY]+"&XW="+downloadTileSizeArray[0]+"&XH="+downloadTileSizeArray[1]+"&tID="+currentTextureTile;if(!format)setFormat('jpg');}else{var downloadTileSizeArray=[tileLayerArray[0][TILE_WIDTH_KEY],tileLayerArray[0][TILE_HEIGHT_KEY],tileLayerArray[0][TILE_WIDTH_KEY],tileLayerArray[0][TILE_HEIGHT_KEY]];var textureApiStr=''
if(!format)setFormat('png');}
if(tileLayerArray[0][TILE_OPACITY_KEY]<100){$("#jpg").css({display:'none'});$("#downloadPreviewContainer").css({"background":"#eee url(img/transGrid.png) repeat 50% 50%"});if(!format)setFormat('png');}else{$("#jpg").css({display:'block'});$("#downloadPreviewContainer").css({'background':'#eee'});}
var downloadTileVerticalPadding=($('#downloadPreviewContainer').height()-downloadTileSizeArray[3])/2;if(downloadTileVerticalPadding<10)downloadTileVerticalPadding=10;$("#downloadTilePadding").css({height:downloadTileSizeArray[3]+'px','padding-top':downloadTileVerticalPadding+'px','padding-bottom':downloadTileVerticalPadding+'px'});var downloadTileHorizontalPadding=($('#downloadPreviewContainer').width()-downloadTileSizeArray[2])/2;if(downloadTileHorizontalPadding<10)downloadTileHorizontalPadding=10;$("#downloadTilePadding").css({width:downloadTileSizeArray[2]+'px','padding-left':downloadTileHorizontalPadding+'px','padding-right':downloadTileHorizontalPadding+'px'});$("#downloadTile").css({width:downloadTileSizeArray[2]+'px',height:downloadTileSizeArray[3]+'px'});var priceStr;if(tilePrice==0){priceStr='FREE';$("#add_tile, #easyCheckout, #paypalLogo").css({display:'none'});$("#patternSpec").css({bottom:'17px'});$("#downloadFile").css({display:'block'});$("#downloadTile_price").css({color:'#77EE00'});}else{priceStr='$'+tilePrice.toFixed(2);$("#add_tile, #easyCheckout, #paypalLogo").css({display:'block'});$("#patternSpec").css({bottom:'108px'});$("#downloadFile").css({display:'none'});$("#downloadTile_price").css({color:pCoolrRed});}
var textureNameStr=tileLayerArray[1][TILE_SHOW_KEY]==true?'Texture: '+currentTextureName:'';$("#downloadTile_price").text(priceStr);$("#download_patternName").html('Pattern: '+currentPatternName+' <span>No. '+currentPatID+'</span>');$("#download_textureName").html(textureNameStr);$("#downloadTile_Width").html('Seamless tile width: <b>'+downloadTileSizeArray[2]+'px</b>');$("#downloadTile_Height").html('Seamless tile height: <b>'+downloadTileSizeArray[3]+'px</b>');if(downloadTileSizeArray[2]!=tileLayerArray[0][TILE_WIDTH_KEY]){$("#downloadTileRepeat_Width").html('Pattern repeat width: '+tileLayerArray[0][TILE_WIDTH_KEY]+'px').css({display:'block'});$("#downloadTileRepeat_Height").html('Pattern repeat height: '+tileLayerArray[0][TILE_HEIGHT_KEY]+'px').css({display:'block'});}else{$("#textureSizeNote, #downloadTileRepeat_Width, #downloadTileRepeat_Height").css({display:'none'});}
var hexes=hexStr();var tileState=updateStateStr('return',downloadTileSizeArray[2],downloadTileSizeArray[3]);textureNameStr=tileLayerArray[1][TILE_SHOW_KEY]==true?' / '+currentTextureName:'';var cartItemStr='Seamless pattern tile '+tileLayerArray[0][TILE_WIDTH_KEY]+'px x '+tileLayerArray[0][TILE_HEIGHT_KEY]+'px<br />'+currentPatternName+textureNameStr;var passName=currentPatternName+textureNameStr;var showDownloadInfo=function(data){$("#downloadTile").css({background:'url('+stagePath+'/'+data[0].path+')'});currentDownload=data[0].path;currentDownloadID=data[0].downloadID;if(tileLayerArray[1][TILE_SHOW_KEY]==true){if(downloadTileSizeArray[0]>tileLayerArray[1][TILE_WIDTH_KEY])$("#textureSizeNote").html('It was necessary to slightly increase the texture size to make this tile seamless').fadeIn();if(downloadTileSizeArray[0]<tileLayerArray[1][TILE_WIDTH_KEY])$("#textureSizeNote").html('It was necessary to slightly decrease the texture size to make this tile seamless').fadeIn();}
$("#download_size").text('File size: '+data[0].size);if(downloadTab=='tile')$("#downloadInactive").fadeOut('fast');var itemThumbW=svgRatio>1?100:svgRatio*100;var itemThumbH=itemThumbW/svgRatio;currentTileDownloadArray=[cartItemStr,data[0].size,tilePrice.toFixed(2),tileState,domainPath+'/'+data[0].thb,Math.round(itemThumbW),Math.round(itemThumbH),data[0].downloadID,downloadFormat];if(downloadTileSizeArray[2]<40||downloadTileSizeArray[3]<40||tileLayerArray[0][TILE_OPACITY_KEY]<100)$("#downloadTileLoader").fadeOut('slow');}
var downloadType=tilePrice==0?0:1;$.get("raster.php?H="+hexes+"&P="+currentPatID+"&TW="+tileLayerArray[0][TILE_WIDTH_KEY]+"&TH="+tileLayerArray[0][TILE_HEIGHT_KEY]+"&AW="+downloadTileSizeArray[2]+"&AH="+downloadTileSizeArray[3]+"&PT="+tileLayerArray[0][TILE_OPACITY_KEY]+"&C=download_"+downloadType+"&S="+tileState+"&U="+userID+"&F="+downloadFormat+textureApiStr+"&DES="+cartItemStr,function(result){console.log(eval(result));if(eval(result)[0].status=='error_freq'){alert('Oops, something went wrong!');}else{if(partner=='')showDownloadInfo(eval(result));else applyPartnerImg(eval(result),passName,tileState);}});adjustDownloadItem();if($("#download1").css('display')=='block'){setTileFitOnOpen();}}
function bestFitTexture(){var longestTileSide=svgRatio>1?tileLayerArray[0][TILE_WIDTH_KEY]:tileLayerArray[0][TILE_HEIGHT_KEY];var shortestTileSide=svgRatio>1?tileLayerArray[0][TILE_HEIGHT_KEY]:tileLayerArray[0][TILE_WIDTH_KEY];var maxFactor=100;var j=1;var k=maxTextureSize;var n=null;var tileAreaW=tileLayerArray[0][TILE_WIDTH_KEY];var tileAreaH=tileLayerArray[0][TILE_HEIGHT_KEY];for(var i=1;i<=maxFactor;i++){if(longestTileSide*i<=maxTextureSize){var m=Math.abs(tileLayerArray[1][TILE_WIDTH_KEY]-longestTileSide*i);if(m<k){k=m;j=i;}}
if(longestTileSide/i>=minTextureSize){var n=Math.abs(tileLayerArray[1][TILE_WIDTH_KEY]-longestTileSide/i);if(n<k){k=n;j=1/i;}}}
textureTileW=tileLayerArray[0][TILE_WIDTH_KEY]*j;textureTileH=tileLayerArray[0][TILE_HEIGHT_KEY]*j;if(j>1){tileAreaW=textureTileW;tileAreaH=textureTileH;}
var downloadTileSizeArray=[textureTileW,textureTileH,tileAreaW,tileAreaH];return downloadTileSizeArray;}
function updateAuthors(){if(tileLayerArray[0][TILE_SHOW_KEY]==true)$("#patternName").html(currentPatternName+' <span>Pattern: '+currentPatID+'</span>');if(tileLayerArray[1][TILE_SHOW_KEY]==true){$("#textureName").fadeIn();$("#launchTextures_0_editor_1").text(currentTextureName);}else $("#textureName").fadeOut();}
function changeTab(box,n,event){$("."+box+"Tab").addClass('deadTab').removeClass('activeTab');$("#"+box+"_tab_"+n).removeClass('deadTab').addClass('activeTab');if(box!='edit'){$("."+box+"Box").css({display:'none'});$("#"+box+n).css({display:'block'});}else{$("."+box+"Box").css({'z-index':1});$("#"+box+n).css({'z-index':2});}
if(box=='download'&&n==0){downloadTab='tile';$("#downloadInactive").fadeOut();$(".tileControls, #downloadTileLoader").css({display:'block'});$(".areaControls, #svg, #pdf").css({display:'none'});$("#jpg").css({'border-bottom':'none'});if(downloadFormat=='svg'){if(event=='click'){if(tileLayerArray[1][TILE_SHOW_KEY]==true)setFormat('jpg');else setFormat('png');}}}
if(box=='download'&&n==1){downloadTab='area';resetGenBtn();setTileFitOnOpen()
$(".areaControls").css({display:'block'});if(userLevel>=5)$("#svg").css({display:'block'});$(".tileControls, #downloadTileLoader").css({display:'none'});$("#downloadPreviewContainer").css({'background-image':'none'});$("#jpg").css({'border-bottom':'1px dashed #ccc'});}
if(box=='edit'&&n==2){currentLiveVnum=currentPatID;}}
function updateStateStr(caller,areaWidth,areaHeight){stateStr.tile_width=tileLayerArray[0][TILE_WIDTH_KEY];stateStr.tile_height=tileLayerArray[0][TILE_HEIGHT_KEY];stateStr.area_width=(areaWidth!=undefined&&areaWidth!=null)?areaWidth:inputPXw.value;stateStr.area_height=(areaHeight!=undefined&&areaHeight!=null)?areaHeight:inputPXh.value;stateStr.offset_x=0;stateStr.offset_y=0;stateStr.pattern_opacity=tileLayerArray[0][TILE_OPACITY_KEY];stateStr.colors=hexStr();stateStr.pattern_id=parseInt(currentPatID);stateStr.texture_id=currentTextureID;stateStr.texture_opacity=tileLayerArray[1][TILE_OPACITY_KEY];stateStr.texture_width=tileLayerArray[1][TILE_WIDTH_KEY];stateStr.texture_height=tileLayerArray[1][TILE_HEIGHT_KEY];stateStr.product_id=currentProductID;if(caller=='return'){if(tileLayerArray[1][TILE_SHOW_KEY]==false){stateStr.texture_id=null;stateStr.texture_opacity=null;stateStr.texture_width=null;stateStr.texture_height=null;}
return encode(stateStr);}
else currentStateString=encode(stateStr);if(caller!='noUndo'){undoArray.splice((undoPos+1),(undoArray.length-(undoPos+1)),currentStateString);undoPos++;handleUndoRedo('setBtns');document.location.hash=currentStateString;}}/*chunk_thumbs*/var currentLiveVnum=null;var currentLiveVnumOfHex=null;var currentVgenHSLarray=[null,null,null];var numOfVthbs=0;function buildThbCells(){paneViewedArray=[];currentPane=0;var styleMenuTitle='Styles';if(currentTagID==0)$("#selectedTag").html(styleMenuTitle);else{var t=getTagFromID(currentTagID).replace('*','');t=t.charAt(0).toUpperCase()+t.slice(1);$("#selectedTag").html(t);}
$("#thbWindow").empty();$("#scrollNav").empty();if(currentTileType=='Textures'){if(currentTagID==-1){}
else if(currentTagID==0){patArray=masterTextureArray;}else{patArray=_.filter(masterTextureArray,function(p){var tagsArray=p[PATARRAY_TAGS_KEY].split(',');return _.find(tagsArray,function(v){return v==currentTagID;});});}}else{if(currentTagID==-1){}
else if(currentTagID==0){patArray=masterPatArray;}else{patArray=_.filter(masterPatArray,function(p){var tagsArray=p[PATARRAY_TAGS_KEY].split(',');return _.find(tagsArray,function(v){return v==currentTagID;});});}}
if(orderBy=='rank'){patArray=_.sortBy(patArray,function(p){return-p[PATARRAY_RANK_KEY];});}
if(orderBy=='patID'){patArray=_.sortBy(patArray,function(p){return-p[PATARRAY_ID_KEY];});}
if(orderBy=='date'){patArray=_.sortBy(patArray,function(p){return-p[PATARRAY_DATE_KEY];});}
numOfThbCols=patArray.length;var thbColActualW=thbW+2+(thbColPadding*2)+(thbCellPadding*2);thbColsPerPane=Math.floor(thbPaneWidth/thbColActualW);var paneLeftPadding=Math.floor((thbPaneWidth-(thbColActualW*thbColsPerPane))/ 2);numOfThbPanes=Math.ceil(numOfThbCols/thbColsPerPane);var thbNavH=(numOfThbRows*(thbW+(thbCellPadding*2)))+(thbColPadding*2);$("#thbContainer").css({height:(thbNavH+29)+'px'});$(".thbNav").css({height:(thbNavH-20)+'px'});$("#thbWindow").css({left:thbWindowPadding+'px',right:thbWindowPadding+'px'});if(wW<900)$("#thbNavBar").css({width:(wW-60)+'px','margin-left':'-'+((wW-60)/2)+'px'});else $("#thbNavBar").css({width:(thbColActualW*thbColsPerPane)+'px','margin-left':'-'+((thbColActualW*thbColsPerPane)/2)+'px'});$("#browser_container").css({height:(thbNavH+78)+'px'});var colCount=0;for(var i=0;i<numOfThbPanes;i++){if(i==(numOfThbPanes-1)||i==1){var pos='end';if(i==1)pos='begin';var periodStr=$('<div>',{'class':'periodStr',id:'periodStr_'+pos});periodStr.html('...');$("#scrollNav").append(periodStr);}
var paneIconDiv=$('<div>',{'class':'paneIcon',id:'paneIcon_'+i,click:function(){var p=$(this).attr('id').split('_')[1];shiftScrollNav(p);if(p<currentPane){$(".thbPane").animate({"left":"+="+((currentPane-p)*thbPaneWidth)+"px"},"slow");loadThbPats(p);}
if(p>currentPane){$(".thbPane").animate({"left":"-="+((p-currentPane)*thbPaneWidth)+"px"},"slow");loadThbPats(p);}
currentPane=p;handleThumbPagination();}});paneIconDiv.html(i+1);$("#scrollNav").css({display:'block'});$("#scrollNav").append(paneIconDiv);shiftScrollNav(0);var thbPaneDiv=$('<div>',{id:'thbPane'+i,'class':'thbPane'});thbPaneDiv.css({'left':(i*thbPaneWidth)+'px',width:thbPaneWidth+'px','padding-left':paneLeftPadding+'px'});$("#thbWindow").append(thbPaneDiv);var thbColWremainder=thbPaneWidth;for(j=0;(j<thbColsPerPane&&colCount<numOfThbCols);j++){var colClassStr=(j==thbColsPerPane-1||colCount==numOfThbCols-1)?'thbCol lastCol':'thbCol';var thbColDiv=$('<div>',{'class':colClassStr});thbColDiv.css({width:(thbW+(thbCellPadding*2))+'px',padding:'0 '+thbColPadding+'px'});thbPaneDiv.append(thbColDiv);for(k=0;k<numOfThbRows;k++){var thbCellLoaderDiv=$('<div>',{'class':'thbCellLoader',});thbCellLoaderDiv.css({width:thbW+'px',height:thbW+'px',padding:'1px '+thbCellPadding+'px 2px'});thbColDiv.append(thbCellLoaderDiv);var thbCellDiv=$('<div>',{'class':'thbCell',id:'thbPos_'+i+'-'+j+'-'+k});thbCellDiv.css({height:thbW+'px'});thbCellLoaderDiv.append(thbCellDiv);if(k==2){var curlerDiv=$('<div>',{'class':'curlerDiv',});curlerDiv.css({height:thbW+'px'});thbCellDiv.append(curlerDiv);}}
var QMdiv=$('<div>',{'class':'infoQM',id:'QM'+colCount,mouseenter:function(){var n=$(this).attr('id').substring(2);populateTags(n);},mouseleave:function(){var n=$(this).attr('id').substring(2);$('#infoPopUp'+n).css({height:"0px"});}});QMdiv.html('?');thbColDiv.append(QMdiv);var infoCellWidth=230;var infoCellOffset=j*(infoCellWidth/thbColsPerPane)+10;var infoDiv=$('<div>',{'class':'infoCellPopUp',id:'infoPopUp'+colCount,});infoDiv.css({left:'-'+infoCellOffset+'px'});QMdiv.append(infoDiv);var infoCellArrowDiv=$('<div>',{'class':'infoCellArrow'});QMdiv.append(infoCellArrowDiv);var vArrowDiv=$('<div>',{'class':'vArrow',id:'v'+patArray[colCount][PATARRAY_ID_KEY],click:function(){var vN=$(this).attr('id').substring(1);getVthbs(null,vN,'vBtn');}});thbColDiv.append(vArrowDiv);colCount++;}}
loadThbPats(0);handleThumbPagination();}
function handleThumbPagination(){var scrollNavWidth=($("#thbNavBar").width()/ 2)-180;if(scrollNavWidth<numOfThbPanes*27){$(".paneIcon").css({display:'none'});$(".periodStr").css({display:'none'});var numOfScrollNavBtns=Math.floor(scrollNavWidth / 27);if(numOfScrollNavBtns%2==0)numOfScrollNavBtns=numOfScrollNavBtns-1;var numBtnsFromCenter=((numOfScrollNavBtns-1)/ 2);var startBtn=currentPane-numBtnsFromCenter<2?2:currentPane-numBtnsFromCenter;var tailEnd=parseInt(currentPane)+parseInt(numBtnsFromCenter);var endBtn=tailEnd>(numOfThbPanes-2)?(numOfThbPanes-2):tailEnd;if(endBtn<numOfScrollNavBtns)endBtn=numOfScrollNavBtns;if(endBtn-startBtn<numOfScrollNavBtns)startBtn=endBtn-(numOfScrollNavBtns-2);if(startBtn>2)$("#periodStr_begin").css({display:'block'});else $("#paneIcon_1").css({display:'block'});if(endBtn<numOfThbPanes-2)$("#periodStr_end").css({display:'block'});else $("#paneIcon_"+(numOfThbPanes-2)).css({display:'block'});$("#paneIcon_0").css({display:'block'});for(var i=startBtn;i<=(endBtn-1);i++){$("#paneIcon_"+i).css({display:'block'});}
$("#paneIcon_"+(numOfThbPanes-1)).css({display:'block'});}}
function loadThbPats(pane){if(pane==0)$("#thbNavPrev").removeClass("thbNavHover").addClass("dead");else $("#thbNavPrev").addClass("thbNavHover").removeClass("dead");if(pane==numOfThbPanes-1)$("#thbNavNext").removeClass("thbNavHover").addClass("dead");else $("#thbNavNext").addClass("thbNavHover").removeClass("dead");if($.inArray(pane,paneViewedArray)==-1){paneViewedArray.push(pane);var patOffset=pane*thbColsPerPane;var numThbsInCurrentPane=((numOfThbCols-patOffset)<thbColsPerPane)?(numOfThbCols-patOffset):thbColsPerPane;var s=0;for(i=0;i<numThbsInCurrentPane;i++){var thbNum=patArray[patOffset+i][PATARRAY_ID_KEY];var thbName=patArray[patOffset+i][PATARRAY_NAME_KEY];thbName=thbName.charAt(0).toUpperCase()+thbName.slice(1);var authorID=patArray[patOffset+i][PATARRAY_AUTHOR_KEY];var thbSlug=makeSlug(thbName);for(j=0;j<numOfThbRows;j++){if(currentTileType=='Textures'){if(j==0){passSize=60;}
if(j==1){passSize=240;}
if(j==2){passSize=600;}
$("#thbPos_"+pane+"-"+i+"-"+j).css({'background-image':'url('+domainPath+'/gen/textures/'+thbSlug+'_texture-'+thbNum+'.png)','background-color':'#7f7f7f','background-size':(passSize)+'px'}).attr({'data-references':thbNum+'+'+passSize});$("#thbPos_"+pane+"-"+i+"-"+j).bind('click',function(){var textureArray=$(this).attr('data-references').split('+');changeTexture(textureArray[0],textureArray[1]);});}else{if(s==0){passSize=60;}
if(s==1){passSize=120;}
if(s==2){passSize=180;}
var indexThbArray=[patArray[patOffset+i][PATARRAY_HEX0_KEY],patArray[patOffset+i][PATARRAY_HEX1_KEY],patArray[patOffset+i][PATARRAY_HEX2_KEY]];$("#thbPos_"+pane+"-"+i+"-"+j).css({'background-image':'url('+domainPath+'/gen/index/'+passSize+'/'+thbSlug+'_pattern-'+indexThbArray[j][0]+'.png)'}).attr({'data-references':thbNum+'+'+indexThbArray[j][1]+'+'+passSize+'&'+thbSlug+'_pattern-'+thbNum+'-'+j+'-'+passSize+'.png'});$("#thbPos_"+pane+"-"+i+"-"+j).bind('click',function(){var patDataArray=$(this).attr('data-references').split('&');var patPropStr=patDataArray[0];var patURL=patDataArray[1];loadSVG(patPropStr,'index');});}
if(j==2){s--;if(s==-1)s=2;}
if(j<2){s++;if(s==3)s=0;}}}}}
function getVthbs(hsl,vNum,caller){if(hsl==null){hsl=currentVgenHSLarray;}
else{currentVgenHSLarray[0]=hsl[0];currentVgenHSLarray[1]=hsl[1];currentVgenHSLarray[2]=hsl[2];}
if(vNum==null){vNum=currentLiveVnum;}else currentLiveVnum=vNum;if(caller=='vBtn'){$("#editor_container").css({top:containerSizePosArray[0][4]+'px'});changeTab('edit',2);currentLiveVnum=vNum;sortContainers('editor','click');if(currentVgenHSLarray[0]==null)return false;}
$("#vGenMask").css({display:'block'});$("#vthbInstruction").css({display:'none'});var numOfVthbsPerPane=14;$("#vThbCell").css({'background-image':'url('+domainPath+'/img/saveBtnLoader1.gif)','background-repeat':'repeat','background-position':'50% 50%'});var vArrayKey;$.each(patArray,function(key,value){if(patArray[key][PATARRAY_ID_KEY]==vNum)vArrayKey=key;});currentLiveVnumOfHex=patArray[vArrayKey][PATARRAY_HEX0_KEY][1].split('-').length;var evalVpatArray=function(data){vPatArray=data;for(i=0;i<numOfVthbsPerPane;i++){var vThbCellDiv=$('<div>',{'class':'vThbCell',id:'vBG_'+vPatArray[i],click:function(){loadSVG($(this).attr('id').split('_')[1],'vThb');}});vThbCellDiv.css({'background-image':'url('+domainPath+'/gen/colors/'+vPatArray[i]+'.png)','background-repeat':'repeat','background-position':'50% 50%'});$('#vThbWindow').prepend(vThbCellDiv);numOfVthbs++;}
$("#vColorRefresh").fadeIn();$("#vGenMask").fadeOut('slow');if(numOfVthbs>numOfVthbsPerPane)$("#vThbScroller > .scrollbar").fadeIn();vThbScrollbar.tinyscrollbar_update();};var vColorImageSize=60;var vColorThbW=svgRatio>=1?Math.round(svgRatio*vColorImageSize):vColorImageSize;var vColorThbH=svgRatio>1?vColorImageSize:Math.round(vColorImageSize/svgRatio);$.get('apiVcolors.php?P='+currentLiveVnum+'&TW='+vColorThbW+'&TH='+vColorThbH+'&NH='+currentLiveVnumOfHex+'&HU='+hsl[0]+'&S='+hsl[1]+'&BW='+hsl[2]+'&NT='+numOfVthbsPerPane+'&R='+vRandomness,function(result){evalVpatArray(eval(result));});}
function shiftScrollNav(p){$(".selectedPaneIcon").addClass('paneIcon').removeClass('selectedPaneIcon');$("#paneIcon_"+p).addClass('selectedPaneIcon').removeClass('paneIcon');}
function buildTextureCells(){var j=0;for(i=0;i<masterTextureArray.length;i++){var thbSlug=makeSlug(masterTextureArray[i][1]);if(j==0){var textureColDiv=$('<div>',{'class':'textureCol'});$("#textureThbWindow").append(textureColDiv);}
if(j<2)j++;else j=0;var textureCellDiv=$('<div>',{'class':'textureCell',id:'texture_'+masterTextureArray[i][0],click:function(){var textureArray=$(this).attr('id').split('_');changeTexture(textureArray[1],null);}});textureCellDiv.css({'background-image':'url('+domainPath+'/gen/textures/90/t'+masterTextureArray[i][0]+'.png)'});textureColDiv.append(textureCellDiv);var textureLabelDiv=$('<div>',{'class':'textureLabel'});textureLabelDiv.html('<span>'+capitaliseFirst(masterTextureArray[i][1])+'</span>');textureCellDiv.append(textureLabelDiv);}}/*chunk_containers*/function adjustToSreenSize(){wW=$(window).width();cW=page=='paging'?(wW-20):(wW-30);wH=$(window).height();thbPaneWidth=cW-(2*thbWindowPadding);if(wW<800){$("#downloadOptionsBtnText").css({display:'none'});$("#download_optionsBtn").css({width:'50px'});$("#patternSizeSliderContainer").css({right:'70px',left:'70px'});}else{$("#downloadOptionsBtnText").css({display:'block'});$("#download_optionsBtn").css({width:'220px'});$("#patternSizeSliderContainer").css({right:'250px',left:'250px'});}}
function adjustEditorWidth(){var panelOffsetRight=494;var editBoxWidth=panelOffsetRight+57+parseInt(svgWidth);$("#editor_container").animate({width:editBoxWidth+'px'});containerSizePosArray[0][1]=editBoxWidth;}
function setContainers(){$("#container").css({top:headerH+"px"});$("#showContentMenu").css({width:(wW-200)+"px",left:"-"+((wW / 2)+16)+"px"});var productContOffsetLeft=5;if(config.displayMode=='full')var viewerH=(wH-429)>minViewerH?(wH-429):minViewerH;else var viewerH=(wH-429);if(partner!='')$("#productViewer_topPanel, #productViewer_bottomPanel").css({height:((viewerH-partnerMinViewerH)/2)+"px"});var veiwerOffsetH=(wH-(viewerH+headerH+5));var userContainerH=wH-57;$("#user_container").css({height:userContainerH+'px'});$("#userScrollbar > .viewport").css({height:(userContainerH-48)+'px'});var editorLeftOffset=Math.round((wW/2)-405);$("#subscriptionScrollbar > .viewport").css({height:(userContainerH-48)+'px'});containerSizePosArray=[['editor',811,445,editorLeftOffset,53,'normal'],['viewer',(wW-10),viewerH,5,veiwerOffsetH,'normal'],['product',860,520,productContOffsetLeft,(wH-(525+headerH)),'none']];for(var i=(containerSizePosArray.length-1);i>=0;i--){if(i==0)$("#"+containerSizePosArray[i][0]+"_container").css({width:containerSizePosArray[i][1]+'px',height:containerSizePosArray[i][2]+'px',left:containerSizePosArray[i][3]+'px',top:(wH+10)+'px',});else $("#"+containerSizePosArray[i][0]+"_container").css({width:containerSizePosArray[i][1]+'px',height:containerSizePosArray[i][2]+'px',left:containerSizePosArray[i][3]+'px',top:containerSizePosArray[i][4]+'px',});if(containerSizePosArray[i][5]=='none'){$("#"+containerSizePosArray[i][0]+'_container').css({display:'none'});}}
if(wH<524)$("#connectToPaypal_container").css({top:'-16px','margin-top':'0px'});else $("#connectToPaypal_container").css({top:'50%','margin-top':'-281px'});}
function resizeSVGviewer(vW,vH){var viewerSVG=$("#previewSVG");viewerSVG.attr('width',vW);viewerSVG.attr('height',vH);viewerSVG.attr('viewBox','0 0 '+vW+' '+vH);var rectSVG=$("#previewSVGrect");rectSVG.attr('width',vW);rectSVG.attr('height',vH);}
function sortContainers(cont,event){var containerPos=containerOrderArray.indexOf(cont);if(containerPos!=-1)containerOrderArray.splice(containerPos,1);if(event=='click'||event=='hoverIn'){containerOrderArray.push(cont);if(event=='hoverIn'){$("#recede_"+cont).css({display:'none'});}}
if(event=='hoverOut'){containerOrderArray.unshift(cont);$("#recede_"+cont).css({display:'block'});}
var i;for(i=0;i<containerOrderArray.length;i++){$("#"+containerOrderArray[i]+"_container").css({'z-index':i});}}
function sizeContainer(contID,sizeTo,call){contID=parseInt(contID);var parentCont=$("#"+containerSizePosArray[contID][0]+'_container');var offset=parentCont.offset();var sizeToW=sizeTo=='min'?minIconW:wW;var sizeToH=sizeTo=='min'?30:wH;if(!(containerSizePosArray[contID][5]=='full'||call=='setup')){containerSizePosArray[contID][1]=parentCont.width();containerSizePosArray[contID][2]=parentCont.height();containerSizePosArray[contID][3]=offset.left;containerSizePosArray[contID][4]=offset.top-headerH;}
containerSizePosArray[contID][5]=sizeTo;if((config.displayMode=='box'&&config.product!='none')&&contID==0){$("#product_container").animate({left:((wW-860)/2)+'px'});containerSizePosArray[1][3]=((wW-860)/2);}
var posLeft=0;var topPos=0-headerH;if(sizeTo=='min'){posLeft=wW-((minimisedContainerArray.length+1)*(sizeToW));$("#"+containerSizePosArray[contID][0]+"_container > .hideOnMin").css({display:'none'});minimisedContainerArray.unshift(contID);}
if(sizeTo=='full'){$("#fullScreenContainer_"+contID).toggle();$("#restoreScreenContainer_"+contID).toggle();$("#headerSignInBtn, #signInBtnContainer, #myThemesContainer, #select_Content").css({'z-index':1});fadePreviewControlsTimer=setTimeout(function(){$("#hidePreviewControls").fadeOut(1000);if(tilePrice>0)$("#pCoolrMaskLayer").fadeIn(1000);},2000);}
parentCont.animate({height:sizeToH+'px',width:sizeToW+'px',top:topPos+'px',left:posLeft+'px'},function(){if(sizeTo=='min'){$("#maximiseContainer_"+contID).css({display:'block'});}
parentCont.css({'box-shadow':'none'});});}
function restoreContainer(contID,caller){if(caller=='restoreScreenContainer'){clearTimeout(fadePreviewControlsTimer);$("#fullScreenContainer_"+contID).toggle();$("#restoreScreenContainer_"+contID).toggle();$("#pCoolrMaskLayer").fadeOut();$("#hidePreviewControls").fadeIn();}
var parentCont=$("#"+containerSizePosArray[contID][0]+'_container');$("#maximiseContainer_"+contID).css({display:'none'});parentCont.animate({width:containerSizePosArray[contID][1]+'px',height:containerSizePosArray[contID][2]+'px',left:containerSizePosArray[contID][3]+'px',top:containerSizePosArray[contID][4]+'px'},function(){$("#"+containerSizePosArray[contID][0]+"_container > .hideOnMin").css({display:'block'});parentCont.css({'box-shadow':'2px 4px 10px rgba(0,0,0,0.9)'});if(caller=='restoreScreenContainer')$("#headerSignInBtn, #signInBtnContainer, #myThemesContainer, #select_Content").css({'z-index':12});});containerSizePosArray[contID][5]='normal';}/*chunk_tags*/function getTagFromID(tID){if(tID==0)return'all';for(var i=0;i<allTagsArray.length;i++){if(allTagsArray[i][0]==tID)return allTagsArray[i][1];}}
function populateTags(n){$('#infoPopUp'+n).stop().animate({height:"180px"},{queue:false,duration:200});var pName=patArray[n][PATARRAY_NAME_KEY];pName=pName.charAt(0).toUpperCase()+pName.slice(1);$('#infoPopUp'+n).html('<h2>ID: '+patArray[n][PATARRAY_ID_KEY]+'<br><b>'+pName+'</b></h2><div class="tagLabel">Tags: </div>');var tagArray=patArray[n][PATARRAY_TAGS_KEY].split(',');$.each(tagArray,function(i,t){var tag=getTagFromID(t);if(tag[0]!='*'){var tagLinkDiv=$('<div>',{id:'vTagLink_'+t,'class':'infoCellTag',click:function(){currentTagID=$(this).attr('id').substring(9);buildThbCells();}});tagLinkDiv.html(tag);$('#infoPopUp'+n).append(tagLinkDiv);}});}
function loadTags(){var evalTagArray=function(data){var j=0;var k=0;var styleMenuColDiv;$.each(allTagsArray,function(i,t){if(menuTags.indexOf(t[1])!=-1){if(j%7==0){k++;styleMenuColDiv=$('<div>',{'class':'styleMenuCol',id:'styleMenuCol_'+k});$("#tagMenu").append(styleMenuColDiv);}
var tagPopularLinkDiv=$('<div>',{'class':'dropDownLink',id:'tagPopLink_'+t[0],click:function(){currentTagID=$(this).attr('id').split('_')[1];buildThbCells();}});tagPopularLinkDiv.html(t[1]);$('#styleMenuCol_'+k).append(tagPopularLinkDiv);j++;}});$("#tagMenu").css({width:(k*150)+'px'});var clearDiv1=$('<div>',{'class':'cb'});$("#tagCloud").append(clearDiv1);var clearDiv0=$('<div>',{'class':'cb'});$("#tagMenu").append(clearDiv0);}
evalTagArray();}
function showAll(){currentTagID=0;buildThbCells();}
function searchTags(){var found=false;var searchStr=$("#searchBox").val().trim().toLowerCase();for(var i=0;i<allTagsArray.length;i++){if(allTagsArray[i][1]==searchStr||allTagsArray[i][1]==searchStr+'s'||allTagsArray[i][1]+'s'==searchStr){currentTagID=allTagsArray[i][0];buildThbCells();found=true;break;}}
if(found==false){$("#noneFound").fadeIn(100).delay(2000).fadeOut(200);}}/*chunk_product*/$(function(){$("#productNavNext").click(function(){$("#productThbCells").animate({"left":"-=200px"},"slow");$("#productNavPrev").css({display:'block'});currentProductThbPane++;if((numOfProductCols/2)-1<currentProductThbPane)$("#productNavNext").css({display:'none'});});$("#productNavPrev").click(function(){$("#productThbCells").animate({"left":"+=200px"},"slow");$("#productNavNext").css({display:'block'});currentProductThbPane--;if(currentProductThbPane==1)$("#productNavPrev").css({display:'none'});});$("#productSizeSlider").slider({animate:true,range:"min",value:((maxTileSize-minTileSize)/2+minTileSize),min:minTileSize,max:maxTileSize,step:1,slide:function(event,ui){changeTileSize(ui.value,0,'product');$(this).mouseup(function(){updateStateStr('productSizeSlider');});},});$("#productSizeSlider .ui-slider-handle").html('Pattern size');$("#prodOp").on('change',function(){currentOptionPrice=$(this).val().split('-')[2];$("#productPrice").text('$'+currentOptionPrice);});$(".nudge").click(function(){var nudgeArray=$(this).attr('id').split('_');nudge(nudgeArray[0],nudgeArray[1]);});$("#productAddToCart").click(function(){if(updatingPartnerCart==false)makeProductImage('partnerProduct');});$("#productGallery").click(function(){window.location='gallery.php';});$("#captureProductBtn").click(function(){makeProductImage('capture');});$("#testProductName").click(function(){makeProductImage('product');});});function showProductView(){var evalPartnerProducts=function(data){productArray=data;var launchProductID=currentProductID==null?productArray[0][0]:currentProductID;changeProduct(launchProductID,'showProductView');buildProductThbCells();}
$.get("api.php?PTID="+partnerID,function(result){evalPartnerProducts(eval(result));});$("#toolbar, #patternSizeSliderContainer").addClass('fadeIn');}
function changeProduct(productID,caller){var productThbPos=-1;for(var i=0;i<productArray.length;i++){if(productArray[i][0]==productID){var productThbPos=i;break;}}
if(productThbPos==-1&&caller=='showProductView')productThbPos=0;if(productThbPos>-1){$("#singleProduct").css({'background-image':'url('+domainPath+'/gen/product/product_'+productArray[productThbPos][0]+'.png)'});$("#productName").html(productArray[productThbPos][1]);currentProductName=productArray[productThbPos][1];$("#productDescription").html(productArray[productThbPos][2]);$("#productPrice").html('$'+productArray[productThbPos][3]);currentOptionPrice=productArray[productThbPos][3];currentTransID=productArray[productThbPos][0];if(panelView!='product'){panelView='product';$("#productSizeSlider").slider('value',getCurrentSliderSizeVal());}
currentProductID=productID;}else showError("productID '"+productID+"' not found");if(caller!='showProductView')updateStateStr('changeProduct');}
function buildProductThbCells(){var numOfCellsPerW=1;var numOfCellsPerH=3;for(var i=0;i<productArray.length;i++){if(i%numOfCellsPerH==0){var productThbColDiv=$('<div>',{'class':'productThbCol',css:'height:'+(numOfCellsPerH*150)+'px'});$("#productThbCells").append(productThbColDiv);numOfProductCols++;}
if(numOfProductCols>2)$("#productNavNext").css({display:'block'});var productThbContainerDiv=$('<div>',{'class':'productThbCellContainer'});productThbColDiv.append(productThbContainerDiv);var productThbDiv=$('<div>',{'class':'productThbCell',id:'product_'+productArray[i][0],click:function(){var productIDinst=$(this).attr('id').split('_')[1];changeProduct(productIDinst);}});productThbDiv.css({"background-image":"url("+domainPath+"/gen/product/thb/product_"+productArray[i][0]+".png)"});productThbContainerDiv.append(productThbDiv);var productThbHoverDiv=$('<div>',{'class':'productThbHover'});productThbDiv.append(productThbHoverDiv);var productThbTitleDiv=$('<div>',{'class':'productThbTitle'});productThbTitleDiv.html(productArray[i][1]+'<h5>$'+productArray[i][3]+'</h5>');productThbContainerDiv.append(productThbTitleDiv);var productDropDownLink=$('<div>',{'class':'dropDownLink',id:'productLink_'+productArray[i][0],click:function(){var productIDinst=$(this).attr('id').split('_')[1];changeProduct(productIDinst);}});productDropDownLink.html(productArray[i][1]);$("#productThbsContainer").append(productDropDownLink);}
var remainderSpacer=numOfCellsPerH-(productArray.length%numOfCellsPerH);if(remainderSpacer<numOfCellsPerH){var remainderSpacerDiv=$('<div>',{'class':'remainderSpacer'});remainderSpacerDiv.css({height:(remainderSpacer*150)+'px'});productThbColDiv.append(remainderSpacerDiv);}
var remainderCols=productArray.length%numOfCellsPerW;for(i=0;i<remainderCols;i++){var remainderColDiv=$('<div>',{'class':'remainderSpacer'});remainderColDiv.css({height:(numOfCellsPerH*150)+'px'});$("#productThbCells").append(remainderColDiv);}
$("#productThbCells").css({width:(((numOfProductCols%numOfCellsPerW)+numOfProductCols)*100)+'px'});$("#singleProductSVGcontainer").fadeIn();}
function nudge(xy,i){var nudgeStep=5;var patNode=document.getElementById('previewPattern');var newPos=parseInt(patNode.getAttributeNS(null,xy))+(i*nudgeStep);patNode.setAttributeNS(null,xy,newPos);if(xy=='x')productOffsetX+=i*nudgeStep;if(xy=='y')productOffsetY+=i*nudgeStep;updateStateStr('nudge');}
function makeProductImage(caller){var upSizeFactor=1;var p=0;for(var i=0;i<productArray.length;i++){if(productArray[i][0]==currentProductID){var p=i;break;}}
if(caller=='partnerProduct'){$("#productAddToCart").html('<img src="img/cartLoader.gif" />');updatingPartnerCart=true;}
var getproductImage=function(data0){var encodeStr=(data0[0].path.match(/pcoolr_(\w+).png$/)||[null,null])[1];console.log(encodeStr);if(caller=='capture'){$("#testProductName").attr("href","?partner="+partnerID+"&state="+encodeStr);$("#productPreview").html('<img src="'+apiDomainPath+data0[0].path+'" />');$("#productPreview_container").fadeIn();$("#productInstURL").val(apiDomainPath+data0[0].path);}
if(caller=='partnerProduct'){var qty=$("#ppQuantityInput").val();var selectedOptionArray=$("#prodOp").val().split('-');var productOptionsID=selectedOptionArray[0];var ctPcode=selectedOptionArray[1];var sides=1;if(currentProductID==4||currentProductID==5||currentProductID==8)sides=2;var addProductInst=function(data1){$.ajax({url:"addProduct.php?pid="+data1[0].insertId+"&pname="+productArray[p][1]+"&pimg="+apiDomainPath+data0[0].path+"&qty="+qty+"&state="+encodeStr+"&price="+currentOptionPrice+"&ctPcode="+ctPcode+"&sides="+sides,success:function(result){if(result){var resultArray=result.split(',');var itemsInCart=resultArray[0];$("#btnCart").text(itemsInCart);$("#partnerCartContainer").fadeIn();alertBar('Customized '+currentProductName+' was successfully added to your Uneekee cart!','success');}else{alertBar(null,'ERROR! Customized '+currentProductName+' could not be added to your Uneekee cart!','error');}
$("#productAddToCart").html('ADD TO CART');updatingPartnerCart=false;}});}
var api1=new Api(addProductInst,displayError,{apiKey:api_key});api1.addProductInstance({"product_id":currentProductID,"partner_id":partnerID,"product_option_id":productOptionsID,"pattern_state":encodeStr});}}
$.get("raster.php?H="+hexStr()+"&P="+currentPatID+"&TW="+(tileLayerArray[0][TILE_WIDTH_KEY]*upSizeFactor)+"&TH="+(tileLayerArray[0][TILE_HEIGHT_KEY]*upSizeFactor)+"&XW="+tileLayerArray[1][TILE_WIDTH_KEY]+"&XH="+tileLayerArray[1][TILE_HEIGHT_KEY]+"&AW=360&AH=500&TT="+tileLayerArray[1][TILE_OPACITY_KEY]+"&tID="+currentTextureTile+"&C=product&S="+currentStateString+"&U="+userID+"&OX="+productOffsetX+"&OY="+productOffsetY+"&PID="+currentProductID,function(result){getproductImage(eval(result));});}/*chunk_colorPicker*/var CROSSHAIRS_LOCATION='img/crosshairs.png';var HUE_SLIDER_LOCATION='img/hue.png';var HUE_SLIDER_ARROWS_LOCATION='img/arrows.png';var SAT_VAL_SQUARE_LOCATION='img/colorBG.png';function hexToRgb(hex_string,default_)
{if(default_==undefined)
{default_=null;}
if(hex_string.substr(0,1)=='#')
{hex_string=hex_string.substr(1);}
var r;var g;var b;if(hex_string.length==3)
{r=hex_string.substr(0,1);r+=r;g=hex_string.substr(1,1);g+=g;b=hex_string.substr(2,1);b+=b;}
else if(hex_string.length==6)
{r=hex_string.substr(0,2);g=hex_string.substr(2,2);b=hex_string.substr(4,2);}
else
{return default_;}
r=parseInt(r,16);g=parseInt(g,16);b=parseInt(b,16);if(isNaN(r)||isNaN(g)||isNaN(b))
{return default_;}
else
{return{r:r / 255,g:g / 255,b:b / 255};}}
function rgbToHex(r,g,b,includeHash)
{r=Math.round(r*255);g=Math.round(g*255);b=Math.round(b*255);if(includeHash==undefined)
{includeHash=true;}
r=r.toString(16);if(r.length==1)
{r='0'+r;}
g=g.toString(16);if(g.length==1)
{g='0'+g;}
b=b.toString(16);if(b.length==1)
{b='0'+b;}
return((includeHash?'#':'')+r+g+b).toUpperCase();}
var arVersion=navigator.appVersion.split("MSIE");var version=parseFloat(arVersion[1]);function fixPNG(myImage)
{if((version>=5.5)&&(version<7)&&(document.body.filters))
{var node=document.createElement('span');node.id=myImage.id;node.className=myImage.className;node.title=myImage.title;node.style.cssText=myImage.style.cssText;node.style.setAttribute('filter',"progid:DXImageTransform.Microsoft.AlphaImageLoader"
+"(src=\'"+myImage.src+"\', sizingMethod='scale')");node.style.fontSize='0';node.style.width=myImage.width.toString()+'px';node.style.height=myImage.height.toString()+'px';node.style.display='inline-block';return node;}
else
{return myImage.cloneNode(false);}}
function trackDrag(node,handler)
{function fixCoords(x,y)
{var nodePageCoords=pageCoords(node);x=(x-nodePageCoords.x)+document.documentElement.scrollLeft;y=(y-nodePageCoords.y)+document.documentElement.scrollTop;if(x<0)x=0;if(y<0)y=0;if(x>node.offsetWidth-1)x=node.offsetWidth-1;if(y>node.offsetHeight-1)y=node.offsetHeight-1;return{x:x,y:y};}
function mouseDown(ev)
{var coords=fixCoords(ev.clientX,ev.clientY);var lastX=coords.x;var lastY=coords.y;handler(coords.x,coords.y);function moveHandler(ev)
{var coords=fixCoords(ev.clientX,ev.clientY);if(coords.x!=lastX||coords.y!=lastY)
{lastX=coords.x;lastY=coords.y;handler(coords.x,coords.y);}}
function upHandler(ev)
{RemoveEventListener(document,'mouseup',upHandler);RemoveEventListener(document,'mousemove',moveHandler);AddEventListener(node,'mousedown',mouseDown);}
AddEventListener(document,'mouseup',upHandler);AddEventListener(document,'mousemove',moveHandler);RemoveEventListener(node,'mousedown',mouseDown);if(ev.preventDefault)ev.preventDefault();}
AddEventListener(node,'mousedown',mouseDown);node.onmousedown=function(e){return false;};node.onselectstart=function(e){return false;};node.ondragstart=function(e){return false;};}
var eventListeners=[];function findEventListener(node,event,handler)
{var i;for(i in eventListeners)
{if(eventListeners[i].node==node&&eventListeners[i].event==event&&eventListeners[i].handler==handler)
{return i;}}
return null;}
function AddEventListener(node,event,handler)
{if(findEventListener(node,event,handler)!=null)
{return;}
if(!node.addEventListener)
{node.attachEvent('on'+event,handler);}
else
{node.addEventListener(event,handler,false);}
eventListeners.push({node:node,event:event,handler:handler});}
function removeEventListenerIndex(index)
{var eventListener=eventListeners[index];delete eventListeners[index];if(!eventListener.node.removeEventListener)
{eventListener.node.detachEvent('on'+eventListener.event,eventListener.handler);}
else
{eventListener.node.removeEventListener(eventListener.event,eventListener.handler,false);}}
function RemoveEventListener(node,event,handler)
{removeEventListenerIndex(findEventListener(node,event,handler));}
function cleanupEventListeners()
{var i;for(i=eventListeners.length;i>0;i--)
{if(eventListeners[i]!=undefined)
{removeEventListenerIndex(i);}}}
AddEventListener(window,'unload',cleanupEventListeners);function hsvToRgb(hue,saturation,value)
{var red;var green;var blue;if(value==0.0)
{red=0;green=0;blue=0;}
else
{var i=Math.floor(hue*6);var f=(hue*6)-i;var p=value*(1-saturation);var q=value*(1-(saturation*f));var t=value*(1-(saturation*(1-f)));switch(i)
{case 1:red=q;green=value;blue=p;break;case 2:red=p;green=value;blue=t;break;case 3:red=p;green=q;blue=value;break;case 4:red=t;green=p;blue=value;break;case 5:red=value;green=p;blue=q;break;case 6:case 0:red=value;green=t;blue=p;break;}}
return{r:red,g:green,b:blue};}
function rgbToHsv(red,green,blue)
{var max=Math.max(Math.max(red,green),blue);var min=Math.min(Math.min(red,green),blue);var hue;var saturation;var value=max;if(min==max)
{hue=0;saturation=0;}
else
{var delta=(max-min);saturation=delta / max;if(red==max)
{hue=(green-blue)/ delta;}
else if(green==max)
{hue=2+((blue-red)/ delta);}
else
{hue=4+((red-green)/ delta);}
hue /=6;if(hue<0)
{hue+=1;}
if(hue>1)
{hue-=1;}}
return{h:hue,s:saturation,v:value};}
function pageCoords(node)
{var x=node.offsetLeft;var y=node.offsetTop;var parent=node.offsetParent;while(parent!=null)
{x+=parent.offsetLeft;y+=parent.offsetTop;parent=parent.offsetParent;}
return{x:x,y:y};}
var huePositionImg=document.createElement('img');huePositionImg.galleryImg=false;huePositionImg.width=38;huePositionImg.height=11;huePositionImg.src=HUE_SLIDER_ARROWS_LOCATION;huePositionImg.style.position='absolute';var hueSelectorImg1=document.createElement('img');hueSelectorImg1.galleryImg=false;hueSelectorImg1.width=30;hueSelectorImg1.height=250;hueSelectorImg1.src=HUE_SLIDER_LOCATION;hueSelectorImg1.style.display='block';var satValImg=document.createElement('img');satValImg.galleryImg=false;satValImg.width=250;satValImg.height=250;satValImg.src=SAT_VAL_SQUARE_LOCATION;satValImg.style.display='block';var crossHairsImg=document.createElement('img');crossHairsImg.galleryImg=false;crossHairsImg.width=21;crossHairsImg.height=21;crossHairsImg.src=CROSSHAIRS_LOCATION;crossHairsImg.style.position='absolute';function makeColorSelector(inputData)
{var rgb,hsv
function colorChanged()
{var hex=rgbToHex(rgb.r,rgb.g,rgb.b);var hueRgb=hsvToRgb(hsv.h,1,1);var hueHex=rgbToHex(hueRgb.r,hueRgb.g,hueRgb.b);inputData.value=hex;changeSVGcolor(hex.substring(1));document.getElementById('swatch'+activeColor).style.background=hex;satValDiv.style.background=hueHex;crossHairs.style.left=((hsv.v*249)-10).toString()+'px';crossHairs.style.top=(((1-hsv.s)*249)-10).toString()+'px';huePos.style.top=((hsv.h*249)-5).toString()+'px';}
function rgbChanged()
{hsv=rgbToHsv(rgb.r,rgb.g,rgb.b);colorChanged();}
function hsvChanged()
{rgb=hsvToRgb(hsv.h,hsv.s,hsv.v);colorChanged();}
var colorSelectorDiv=document.createElement('div');colorSelectorDiv.style.top='0';colorSelectorDiv.style.position='relative';colorSelectorDiv.style.height='255px';colorSelectorDiv.style.width='283px';var satValDiv=document.createElement('div');satValDiv.style.position='relative';satValDiv.style.width='250px';satValDiv.style.height='250px';var newSatValImg=fixPNG(satValImg);satValDiv.appendChild(newSatValImg);var crossHairs=crossHairsImg.cloneNode(false);satValDiv.appendChild(crossHairs);function satValDragged(x,y)
{hsv.s=1-(y/249);hsv.v=(x/249);hsvChanged();}
trackDrag(satValDiv,satValDragged)
colorSelectorDiv.appendChild(satValDiv);var hueDiv=document.createElement('div');hueDiv.style.position='absolute';hueDiv.style.left='253px';hueDiv.style.top='0px';hueDiv.style.width='30px';hueDiv.style.height='250px';var huePos=fixPNG(huePositionImg);hueDiv.appendChild(hueSelectorImg1.cloneNode(false));hueDiv.appendChild(huePos);function hueDragged(x,y)
{hsv.h=y/249;hsvChanged();}
trackDrag(hueDiv,hueDragged);colorSelectorDiv.appendChild(hueDiv);function inputDataChanged()
{rgb=hexToRgb(inputData.value,{r:0,g:0,b:0});rgbChanged();}
$("#hexBox").change(function(){inputDataChanged();});inputData.size=8;inputData.style.position='absolute';inputData.style.right='0';inputData.style.top='0';colorSelectorDiv.appendChild(inputData);inputDataChanged();return colorSelectorDiv;}
function makeColorSelectors()
{var node=document.getElementById('hexBox');var parent=node.parentNode;var prevNode=node.previousSibling;var selector=makeColorSelector(node);parent.insertBefore(selector,(prevNode?prevNode.nextSibling:null));}/*chunk_palette*/var showPatternDeleteBoxes=0;var showColorDeleteBoxes=0;var savedColorsArray=[];var cachedSavedColorsArray=[];var userSavedColorsArray=[];var savedPalettesArray=[];var cachedSavedPatternsArray=[];var userSavedPatternsArray=[];var keepColors=false;var shuffleType=0;var setCurrentShuffle=true;function arrayUnique(array){var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i].toUpperCase()===a[j].toUpperCase())
a.splice(j,1);}}
return a;};function getCookieStrs(){if($.cookie('savedColorCookie')){var colorCookie=$.cookie('savedColorCookie');cachedSavedColorsArray=colorCookie.split(',');for(var i=0;i<cachedSavedColorsArray.length;i++){buildSavedColorCells(cachedSavedColorsArray[i],'cached','loadFromCookies');}}
if($.cookie('savedPatternCookie')){cachedSavedPatternsArray=$.cookie('savedPatternCookie').split(',');if(cachedSavedPatternsArray.length>0&&userSavedPatternsArray.length>0){$("#mergePatterns").css({display:'block'});}
for(var i=0;i<cachedSavedPatternsArray.length;i++){buildSavedPatternCells(cachedSavedPatternsArray[i],'cached');}}
$("#myThemes").text(cachedSavedPatternsArray.length);setSaveText();}
function applyUserData(){$.get("api.php?UD=true&U="+userID,function(result){var userDataArray=eval(result);var userColorsArray=userDataArray[0].split(',');if(userColorsArray[0]=='')userColorsArray=[];if(userColorsArray.length>0){for(i=0;i<userColorsArray.length;i++){buildSavedColorCells(userColorsArray[i],'user');}}
userSavedPatternsArray=userDataArray[1].split(',');if(userSavedPatternsArray[0]=='')userSavedPatternsArray=[];if(userSavedPatternsArray.length>0){for(i=0;i<userSavedPatternsArray.length;i++){buildSavedPatternCells(userSavedPatternsArray[i],'user');}}
setSaveText();});}
function mergeSavedColors(){var uniqueSavedColorsArray=arrayUnique(savedColorsArray);savedColorsArray=[];userSavedColorsArray=[];cachedSavedColorsArray=[];$("#cachedColors").empty();$("#userColors").empty();ajaxSaveColorsStr='';for(var i=0;i<uniqueSavedColorsArray.length;i++){buildSavedColorCells(uniqueSavedColorsArray[i],'user');if(i>0)ajaxSaveColorsStr+=',';ajaxSaveColorsStr+=uniqueSavedColorsArray[i].toUpperCase();}
$.get('api.php?UC='+ajaxSaveColorsStr+'&U='+userID,function(result){});saveColorsToCookies();}
function mergeSavedPatterns(){showPatternDeleteBoxes=0;var combinedSavedPatterns=cachedSavedPatternsArray.concat(userSavedPatternsArray);var uniqueSavedPatternsArray=arrayUnique(combinedSavedPatterns);userSavedPatternsArray=[];$("#cachedSavedPatterns").empty();$("#userSavedPatterns").empty();ajaxSavePatternsStr='';for(var i=0;i<uniqueSavedPatternsArray.length;i++){buildSavedPatternCells(uniqueSavedPatternsArray[i],'user');if(i<cachedSavedPatternsArray.length){if(i>0)ajaxSavePatternsStr+=',';ajaxSavePatternsStr+=cachedSavedPatternsArray[i];}
userSavedPatternsArray.push(uniqueSavedPatternsArray[i]);}
cachedSavedPatternsArray=[];$.get('api.php?UP='+ajaxSavePatternsStr+'&U='+userID,function(result){});savePatternsToCookies();}
function setSaveText(){if(savedColorsArray.length<2){document.getElementById('shuffleType1').style.display='none';document.getElementById('cpShuffleLabel').style.display='none';}else{document.getElementById('shuffleType1').style.display='block';document.getElementById('cpShuffleLabel').style.display='block';}
if(partner==''){if(userID==0&&cachedSavedColorsArray.length>0){$("#loginToSaveColors").css({display:'block'});}else{$("#loginToSaveColors").css({display:'none'});}
if(savedColorsArray.length==0){$("#noSavedColorsLabel").css({display:'block'});$("#showDeleteColor").css({display:'none'});}else{$("#noSavedColorsLabel").css({display:'none'});$("#showDeleteColor").css({display:'block'});}
if(cachedSavedColorsArray.length>0)$("#cachedColorsLabel").css({display:'block'});else $("#cachedColorsLabel").css({display:'none'});if(userSavedColorsArray.length>0&&userID!=0)$("#userColorsLabel").css({display:'block'});else $("#userColorsLabel").css({display:'none'});if(cachedSavedColorsArray.length>0&&userID!=0)$("#mergeColors").css({display:'block'});else $("#mergeColors").css({display:'none'});if(userID==0&&cachedSavedPatternsArray.length>0){$("#loginToSavePatterns").css({display:'block'});}else{$("#loginToSavePatterns").css({display:'none'});}
if(cachedSavedPatternsArray.length>0||userSavedPatternsArray.length>0){$("#showDeletePattern").css({display:'block'});$("#noSavedPatternsLabel").css({display:'none'});}else{$("#showDeletePattern").css({display:'none'});$("#noSavedPatternsLabel").css({display:'block'});}
if(cachedSavedPatternsArray.length>0)$("#cachedPatternsLabel").css({display:'block'});else $("#cachedPatternsLabel").css({display:'none'});if(userSavedPatternsArray.length>0)$("#userPatternsLabel").css({display:'block'});else $("#userPatternsLabel").css({display:'none'});if(cachedSavedPatternsArray.length>0&&userID!=0)$("#mergePatterns").css({display:'block'});else $("#mergePatterns").css({display:'none'});}
$("#myThemes").html(userSavedPatternsArray.length+cachedSavedPatternsArray.length);}
function savePat(){updateStateStr('noUndo');$("#saveBtn").css({'background-position':'0% 0%'});$("#saveBtnLoader").css({display:'block'});var createNewSavedTheme=function(data){if(data[0].status=='success'){$("#saveBtnLoader").css({display:'none'});$("#saveBtn").css({'background-position':'100% 50%'});$("#myThemesContainerBG").fadeIn('fast').fadeOut(3000);buildSavedPatternCells(currentStateString,'cached');cachedSavedPatternsArray.push(currentStateString);showPatternDeleteBoxes=1;showDeleteBoxes('Pattern');savePatternsToCookies('savePat');}}
var downloadType=tilePrice==0?0:1;$.get("raster.php?H="+hexStr()+"&P="+currentPatID+"&TW="+tileLayerArray[0][TILE_WIDTH_KEY]+"&TH="+tileLayerArray[0][TILE_HEIGHT_KEY]+"&XW="+tileLayerArray[1][TILE_WIDTH_KEY]+"&XH="+tileLayerArray[1][TILE_HEIGHT_KEY]+"&AW=90&AH=90&PT="+tileLayerArray[0][TILE_OPACITY_KEY]+"&TT="+tileLayerArray[1][TILE_OPACITY_KEY]+"&tID="+currentTextureTile+"&C=save&S="+currentStateString+"&U="+userID+"&D=",function(result){createNewSavedTheme(eval(result));});}
function savePatternsToCookies(caller){var savedPatternStr='';for(d=0;d<cachedSavedPatternsArray.length;d++){if(d>0)savedPatternStr+=',';savedPatternStr+=cachedSavedPatternsArray[d];}
$("#myThemes").text(d);$.cookie("savedPatternCookie",savedPatternStr,{expires:300});setSaveText();userScrollbar.tinyscrollbar_update();}
function addColor(color){if(showColorDeleteBoxes==1){showDeleteBoxes('Color');}
if(cookiesEnabled=false)alert('Browser cookies must be enabled to save colors');else{var alreadySaved=false;for(i=0;i<savedColorsArray.length;i++){if(savedColorsArray[i].toUpperCase()==liveAttArray[color][0].toUpperCase()){alreadySaved=true;}}
changeTab('color',1);if(alreadySaved==true){$("#colorAlreadySaved").css('display','block').delay(2000).fadeOut('slow');$("#savedColor_user-"+liveAttArray[color][0].toUpperCase()).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);$("#savedColor_cached-"+liveAttArray[color][0].toUpperCase()).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);}
if(alreadySaved==false){buildSavedColorCells(liveAttArray[color][0],'cached');saveColorsToCookies();}}}
function saveColorsToCookies(){var savedColorStr='';for(d=0;d<cachedSavedColorsArray.length;d++){if(d>0)savedColorStr+=',';savedColorStr+=cachedSavedColorsArray[d].toUpperCase();}
setSaveText();$.cookie("savedColorCookie",savedColorStr,{expires:300});}
function buildSavedPatternCells(savedPatState,parent){var savedPatObj=decode(savedPatState);var savedPatContainer=document.getElementById(parent+'SavedPatterns');var savedThemeCell=document.createElement('div');savedThemeCell.className='themeCell';savedThemeCell.id='savedTheme_'+parent+'_'+savedPatState;if(savedPatContainer.hasChildNodes())savedPatContainer.insertBefore(savedThemeCell,savedPatContainer.firstChild);else savedPatContainer.appendChild(savedThemeCell);var savedPatCell=document.createElement('div');savedPatCell.className='savedPatCell';savedPatCell.id='savedPattern_'+parent+'_'+savedPatState;savedPatCell.style.background='url('+apiDomainPath+'gen/saved/'+savedPatObj.pattern_id+'/'+savedPatState+'.png)';savedPatCell.onclick=function(){var savedPatternCellArray=this.id.split('_');actionSavedPattern(savedPatternCellArray[2],savedPatternCellArray[1]);}
savedThemeCell.appendChild(savedPatCell);buildSavedPaletteCells('savedTheme_'+parent+'_'+savedPatState,savedPatObj.colors);var deleteSavedPatCell=document.createElement('div');deleteSavedPatCell.className='delPatternCell';deleteSavedPatCell.id='deleteSavedPat_'+savedPatState;savedPatCell.appendChild(deleteSavedPatCell);numOfSavedPats++;$("#savedStat").html(numOfSavedPats);}
function buildSavedColorCells(color,parent,caller){if(parent=='user'){userSavedColorsArray.push(color);}
else{if(caller!='loadFromCookies')cachedSavedColorsArray.push(color);}
if(userSavedColorsArray.length>0&&cachedSavedColorsArray.length>0)$("#mergeColors").css({display:'block'});savedColorsArray.push(color);document.getElementById('showDeleteColor').style.display='block';var paletteDiv=document.getElementById(parent+'Colors');var savedColorCell=document.createElement('div');savedColorCell.className='savedColorCell';savedColorCell.id='savedColor_'+parent+'-'+color.toUpperCase();savedColorCell.style.background='#'+color;savedColorCell.onclick=function(){var n=this.id.substring(11);nArray=n.split('-');actionSavedColor(nArray[1],nArray[0]);}
if(paletteDiv.hasChildNodes())paletteDiv.insertBefore(savedColorCell,paletteDiv.firstChild);else paletteDiv.appendChild(savedColorCell);var deleteColorCell=document.createElement('div');deleteColorCell.className='delColorCell';savedColorCell.appendChild(deleteColorCell);}
function buildSavedPaletteCells(containerCell,hexStr){var passedHexStrArray=hexStr.split('-');var paletteDiv=document.getElementById(containerCell);var savedPaletteContainer=document.createElement('div');savedPaletteContainer.className='savedPaletteContainer';savedPaletteContainer.id='savedPalette_'+hexStr;paletteDiv.appendChild(savedPaletteContainer);var i=0;var cellWidth=0;var cellWidthFloat=44/passedHexStrArray.length;if(containerCell.split('_')[0]=='savedTheme')cellWidthFloat=70/passedHexStrArray.length;var runningWidth=0;while(i<passedHexStrArray.length){cellWidth=Math.floor(cellWidthFloat*(i+1))-runningWidth;runningWidth+=cellWidth;var savedPaletteCell=document.createElement('div');savedPaletteCell.className='savedPaletteCell';savedPaletteCell.style.width=cellWidth+'px';savedPaletteCell.style.left=(runningWidth-cellWidth)+'px';savedPaletteCell.style.backgroundColor='#'+passedHexStrArray[i];savedPaletteCell.id='paletteCell_'+passedHexStrArray[i];savedPaletteCell.onclick=function(){var n=this.id.substring(12);actionSavedColor(n);}
savedPaletteContainer.appendChild(savedPaletteCell);i++;}
var applySavedPalette=document.createElement('div');applySavedPalette.className='applySavedPaletteButt';applySavedPalette.id='applyPalette_'+hexStr;applySavedPalette.onclick=function(){var m=this.id.substring(13);actionSavedPalette(m);}
applySavedPalette.onmouseover=function(){var m=this.id.substring(13);hoverPalette(m,1);}
applySavedPalette.onmouseout=function(){var m=this.id.substring(13);hoverPalette(m,0);}
savedPaletteContainer.appendChild(applySavedPalette);if(containerCell.substring(0,10)!='savedTheme'){var deletePaletteCell=document.createElement('div');deletePaletteCell.className='delColorCell';deletePaletteCell.id='deletePalette_'+hexStr;deletePaletteCell.onclick=function(){var o=this.id.substring(14);actionSavedPalette(o);}
savedPaletteContainer.appendChild(deletePaletteCell);}}
function showDeleteBoxes(ref){var displayStr='none';if(ref=='Color'){if(showColorDeleteBoxes==0){showColorDeleteBoxes=1;displayStr='block';}else showColorDeleteBoxes=0;}
if(ref=='Pattern'){if(showPatternDeleteBoxes==0){$(".savedPatCell").addClass("savedPatCellDel");$(".savedPatCellDel").removeClass("savedPatCell");showPatternDeleteBoxes=1;displayStr='block';}else{$(".savedPatCellDel").addClass("savedPatCell");$(".savedPatCell").removeClass("savedPatCellDel");showPatternDeleteBoxes=0;}}
var deleteDivsArray=new Array();var deleteDivsArray=document.getElementsByTagName("div");for(i=0;i<deleteDivsArray.length;i++){if(deleteDivsArray[i].className=='del'+ref+'Cell'){deleteDivsArray[i].style.display=displayStr;}}}
function hoverPalette(hexStr,inOut){if(inOut==1){$("#savedPalette_"+hexStr).addClass("selectWholePalette");$("#savedPalette_"+hexStr).children().css('background-image','url(img/trans50wht.png)');}
else{$("#savedPalette_"+hexStr).removeClass("selectWholePalette");$("#savedPalette_"+hexStr).children().css('background-image','none');}}
function actionSavedPattern(state,parent){if(showPatternDeleteBoxes==0)launchPcoolr(state,'saved');else{var savedPatternNode=document.getElementById('savedTheme_'+parent+'_'+state);document.getElementById(parent+'SavedPatterns').removeChild(savedPatternNode);if(parent=='cached'){for(d=0;d<cachedSavedPatternsArray.length;d++){if(cachedSavedPatternsArray[d]==state)cachedSavedPatternsArray.splice(d,1);}
savePatternsToCookies();}else{for(d=0;d<userSavedPatternsArray.length;d++){if(userSavedPatternsArray[d]==state)userSavedPatternsArray.splice(d,1);}
$.get('api.php?UPD='+state+'&U='+userID,function(result){});}
setSaveText();}}
function actionSavedPalette(hexStr){if(showColorDeleteBoxes==0){var hexSplit=hexStr.split('-');var newHexStr='';if(hexSplit.length>numOfHex){for(var i=0;i<numOfHex;i++){newHexStr+=hexSplit[i];if(i<numOfHex-1)newHexStr+='-';}}else if(hexSplit.length<numOfHex){for(var i=0;i<numOfHex;i++){var j=i%hexSplit.length;newHexStr+=hexSplit[j];if(i<numOfHex-1)newHexStr+='-';}}else newHexStr=hexStr;setLiveAttArray(newHexStr);initiateColors();if(keepColors==true)keepPalette();}
else{var savedPaletteNode=document.getElementById('savedPalette_'+hexStr);document.getElementById('savedPalettesDiv').removeChild(savedPaletteNode);for(d=0;d<savedPalettesArray.length;d++){if(savedPalettesArray[d]==hexStr)savedPalettesArray.splice(d,1);}}}
function actionSavedColor(color,parent){if(showColorDeleteBoxes==0)setHexBox(color);else{var savedColorNode=document.getElementById('savedColor_'+parent+'-'+color);document.getElementById(parent+'Colors').removeChild(savedColorNode);if(parent=='cached'){for(d=0;d<cachedSavedColorsArray.length;d++){if(cachedSavedColorsArray[d]==color)cachedSavedColorsArray.splice(d,1);}
saveColorsToCookies();}else{for(d=0;d<userSavedColorsArray.length;d++){if(userSavedColorsArray[d]==color)userSavedColorsArray.splice(d,1);}
saveColorsToAccount();}
for(d=0;d<savedColorsArray.length;d++){if(savedColorsArray[d]==color)savedColorsArray.splice(d,1);}
setSaveText();}}
function saveColorsToAccount(){var colorStr='';for(i=0;i<userSavedColorsArray.length;i++){if(i>0)colorStr+=',';colorStr+=userSavedColorsArray[i].toUpperCase();}
if(colorStr=='')colorStr='empty';$.get('api.php?UC='+colorStr+'&U='+userID,function(result){});}
function keepPalette(){keepColors=true;document.getElementById('keepColors_checkBox').style.backgroundPosition='50% 100%';var hexStrArray=hexStr().split('-');var i=0;var cellWidth=0;var cellWidthFloat=100/hexStrArray.length;var runningWidth=0;while(i<hexStrArray.length){cellWidth=Math.floor(cellWidthFloat*(i+1))-runningWidth;runningWidth+=cellWidth;var savedPaletteCell=document.createElement('div');savedPaletteCell.className='keepPaletteCell';savedPaletteCell.style.width=cellWidth+'px';savedPaletteCell.style.left=(runningWidth-cellWidth)+'px';savedPaletteCell.style.backgroundColor='#'+hexStrArray[i];savedPaletteCell.id='paletteCell_'+hexStrArray[i];savedPaletteCell.onclick=function(){var n=this.id.substring(12);actionSavedColor(n);}
document.getElementById('keepColorsPalette').appendChild(savedPaletteCell);i++;}}
function randomColor(){var rint=Math.round(0xffffff*Math.random());return('#0'+rint.toString(16)).replace(/^#0([0-9a-f]{6})$/i,'#$1').toUpperCase();}
function shuffleTypeSelect(id){document.getElementById('shuffleType'+shuffleType).style.backgroundPosition='50% 0%';shuffleType=id;document.getElementById('shuffleType'+id).style.backgroundPosition='50% 100%';if(id==1){changeTab('color',1);$("#savedColorIndicator").css({display:'block'});}else $("#savedColorIndicator").css({display:'none'});}
function shuffle(){var preShuffleActiveColor=activeColor;var shuffleArray=[];if(shuffleType==0){if(setCurrentShuffle==true){setLiveAttArray(hexStr());setCurrentShuffle=false;}
shuffleArray=liveAttArray;}else setCurrentShuffle=true;if(shuffleType==1)shuffleArray=savedColorsArray;if(numOfHex==2&&shuffleType==0)liveAttArray.reverse();else{var startShuffleArrayStr=liveAttArray.join();function shuffleArrays(){if(shuffleType==2){genShufflePalette(numOfHex);}else{var i=0;while(i<numOfHex){var j;var tempj;if(shuffleType==0){j=Math.floor(Math.random()*numOfHex);tempj=shuffleArray[j][0];}
else{j=Math.floor(Math.random()*shuffleArray.length);tempj=shuffleArray[j];}
var tempi=liveAttArray[i][0];liveAttArray[i][0]=tempj;if(shuffleType==0){liveAttArray[j][0]=tempi;}
i++;}}
return liveAttArray.join();}
while(startShuffleArrayStr==shuffleArrays()){}}
setLiveAttArray(hexStr());var i=0
while(i<numOfHex){activeColor=i;changeSVGcolor(liveAttArray[i][0]);document.getElementById('swatch'+activeColor).style.background='#'+liveAttArray[i][0];i++;}
activeColor=preShuffleActiveColor;selectObj(activeColor);if(keepColors==true)keepPalette();}
function getHueArray(i){if(i<256){rgbArray=[255,i,0];}
if(i>255&&i<511){rgbArray=[510-i,255,0];}
if(i>510&&i<766){rgbArray=[0,255,i-510];}
if(i>765&&i<1021){rgbArray=[0,1020-i,255];}
if(i>1020&&i<1276){rgbArray=[i-1020,0,255];}
if(i>1275&&i<1530){rgbArray=[255,0,1530-i];}
return rgbArray;}
function bias(i){var biasFactor=256;if(i<256){return i;}
if(i>255&&i<511){return i=i-rand(0,biasFactor);}
if(i>510&&i<766){return i=i+rand(0,biasFactor);}
if(i>765&&i<1021){return i;}
if(i>1020&&i<1276){return i=i-rand(0,biasFactor);}
if(i>1275&&i<1530){i=i+rand(0,biasFactor);if(i>1329)i=i-1329;return i;}}
function rgbHex(r,g,b,includeHash){r=Math.round(r);g=Math.round(g);b=Math.round(b);if(includeHash==undefined){includeHash=true;}
r=r.toString(16);if(r.length==1){r='0'+r;}
g=g.toString(16);if(g.length==1){g='0'+g;}
b=b.toString(16);if(b.length==1){b='0'+b;}
return((includeHash?'#':'')+r+g+b).toUpperCase();}
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function randNegPos(){return rand(1,2)==1?-1:1;}
function genShufflePalette(paletteSize){var toneRange=8;var hueStep=64;var bwPadding=1;var complimentary=true;var segArray=new Array(2);segArray[0]=rand(1,(paletteSize-1));segArray[1]=paletteSize-segArray[0];var huePosArray=new Array(2);huePosArray[0]=bias(rand(0,1529));if(complimentary==true){var compCol=huePosArray[0]+rand(383,1149);if(compCol>1529)compCol=compCol-1529;huePosArray[1]=compCol;}else huePosArray[1]=bias(rand(0,1529));var h=0;for(var i=0;i<segArray.length;i++){var randHuePos=huePosArray[i];var randTonePos=rand(3,3);var hueUpDown=randNegPos();var toneUpDown=randNegPos();var toneStep=rand(bwPadding,(toneRange-bwPadding));var bw=randNegPos()<0?255:0;var satFactor=rand(1,3);var satStartLow=false;if(satFactor>3)satStartLow=true;var deSatFactor=rand(1,1);for(var j=0;j<segArray[i];j++){var hueArray=getHueArray(randHuePos);var mR=hueArray[0];var mG=hueArray[1];var mB=hueArray[2];var hueGray=(0.3*mR)+(0.59*mG)+(0.11*mB);var invHueGray=255-hueGray;mR=parseInt(((mR*satFactor)+(invHueGray*deSatFactor))/(satFactor+deSatFactor));mG=parseInt(((mG*satFactor)+(invHueGray*deSatFactor))/(satFactor+deSatFactor));mB=parseInt(((mB*satFactor)+(invHueGray*deSatFactor))/(satFactor+deSatFactor));randHuePos=randHuePos+(hueUpDown*hueStep);if(randHuePos<0)randHuePos=1529+randHuePos;if(randHuePos>1529)randHuePos=randHuePos-1529;var r=Math.round((mR*toneStep+bw*(toneRange-toneStep))/ toneRange);var g=Math.round((mG*toneStep+bw*(toneRange-toneStep))/ toneRange);var b=Math.round((mB*toneStep+bw*(toneRange-toneStep))/ toneRange);toneStep=toneStep+toneUpDown;if(toneStep<bwPadding||toneStep>toneRange-bwPadding){toneStep=toneRange/2;randHuePos=rand(0,1529);}
if(satFactor>1)satFactor--;if(deSatFactor>1)satFactor--;liveAttArray[h][0]=rgbHex(r,g,b,false);h++;}}}
var HSLToRGB=function(hsl){var m1,m2,r,g,b;var h=hsl[0],s=hsl[1],l=hsl[2];m2=(l<=0.5)?l*(s+1):l+s-l*s;m1=l*2-m2;return[this.hueToRGB(m1,m2,h+0.33333),this.hueToRGB(m1,m2,h),this.hueToRGB(m1,m2,h-0.33333)];}
var hueToRGB=function(m1,m2,h){h=(h<0)?h+1:((h>1)?h-1:h);if(h*6<1)return m1+(m2-m1)*h*6;if(h*2<1)return m2;if(h*3<2)return m1+(m2-m1)*(0.66666-h)*6;return m1;}
var RGBToHSL=function(rgb){var min,max,delta,h,s,l;var r=rgb[0],g=rgb[1],b=rgb[2];min=Math.min(r,Math.min(g,b));max=Math.max(r,Math.max(g,b));delta=max-min;l=(min+max)/ 2;s=0;if(l>0&&l<1){s=delta /(l<0.5?(2*l):(2-2*l));}
h=0;if(delta>0){if(max==r&&max!=g)h+=(g-b)/ delta;if(max==g&&max!=b)h+=(2+(b-r)/ delta);if(max==b&&max!=r)h+=(4+(r-g)/ delta);h /=6;}
return[h,s,l];}
var rgb2Hex=function(rgb){var hex=[rgb[0].toString(16),rgb[1].toString(16),rgb[2].toString(16)];$.each(hex,function(nr,val){if(val.length==1){hex[nr]='0'+val;}});return hex.join('');}
function buildColorSelector(sat){var sStr=Math.round(sat*100);currentVgenHSLarray[1]=sStr;var numOfSelectorCols=12;var numOfSelectorRows=5;var lightnessPadding=0.15;$("#colorSelectorBox").empty();for(i=0;i<numOfSelectorCols;i++){var hueColDiv=$('<div>',{'class':'hueCol',id:'hueCol_'+i});$("#colorSelectorBox").append(hueColDiv);var h;h=i/numOfSelectorCols;var hStr=Math.round(h*1529);for(j=0;j<numOfSelectorRows;j++){var l;var lightnessStep=(1-(lightnessPadding*2))/(numOfSelectorRows-1);l=(j*lightnessStep)+lightnessPadding;var lStr=j+1;var hslArray=[h,sat,l];var rgb=HSLToRGB(hslArray);var deNatRGB=[Math.round(255*rgb[0]),Math.round(255*rgb[1]),Math.round(255*rgb[2])];var hex=rgb2Hex(deNatRGB);var selectorCellDiv=$('<div>',{'class':'selectorCell',id:'selectorCell_'+hStr+'_'+sStr+'_'+lStr,click:function(){var idStrArray=$(this).attr('id').split('_');getVthbs([idStrArray[1],idStrArray[2],idStrArray[3]],null,'selectorColor');$(".selectorCell").removeClass('selectedVcell');$(this).addClass('selectedVcell');}});if(currentVgenHSLarray[0]==hStr&&currentVgenHSLarray[2]==lStr)selectorCellDiv.addClass('selectedVcell');selectorCellDiv.css({'background':'#'+hex});$('#hueCol_'+i).append(selectorCellDiv);}}}/*chunk_editor*/var svgWidth=260;var svgheight=260;var svgRatio=1;var svg=null;var activeColor=0;var numOfHex=3;var editorLoaded=false;var currentPatID=null;var currentTextureID=null;var tileLayerArray=[['pattern',0,0,0,true,100],['texture',0,0,0,true,50]];var TILE_TYPE_KEY=0;var TILE_SLIDERSIZEVAL_KEY=1;var TILE_WIDTH_KEY=2;var TILE_HEIGHT_KEY=3;var TILE_SHOW_KEY=4;var TILE_OPACITY_KEY=5;var tileHfloat=null;var tileWfloat=null;var tilePrice;var areaPrice;var svgContainerHeight=268;var maxLayers=10;var liveAttArray=[];var livePatArray=[['','','',[0,0]],['','','',[0,0]]];var numOfSavedPats=0;var doubleSize=[159,120,119,64];var svgLoading=false;var svgAreaArray=[['preview',1],['area',1]];var e=0;while(liveAttArray.push([])<maxLayers){liveAttArray[e].push('','');e++;}
function launchPcoolr(encodeStr,caller){launchingFromState=true;var launch=decode(encodeStr);$("#hexBox").val('#'+launch.colors.split('-')[0]);loadSVG(launch.pattern_id+'+'+launch.colors+'+'+launch.tile_width);if(launch.texture_id!=undefined&&showTextures==1)changeTexture(launch.texture_id,launch.texture_width);if(launch.texture_id==0||launch.texture_id==undefined||showTextures==0)changeTexture(0,50);if(launch.texture_width!=undefined&&launch.texture_width!=0){changeTileSize(launch.texture_width,1,'stateTextureWidth');$("#textureSizeSlider").slider('value',launch.texture_width);}else{changeTileSize(250,1,'stateTextureWidth');$("#textureSizeSlider").slider('value',250);}
if(launch.pattern_opacity!=undefined){$("#patternOpacitySlider").slider('value',launch.pattern_opacity);if(launch.pattern_opacity==0){showHideTileLayer(0,0);$("#patternTileOpacity").html('Opacity: 0%');}
else changeTileOpacity(launch.pattern_opacity,0);}else{$("#patternOpacitySlider").slider('value',100);changeTileOpacity(100,0);}
if(launch.texture_opacity!=undefined){$("#textureOpacitySlider").slider('value',launch.texture_opacity);if(launch.texture_opacity==0){changeTexture(0,50);$("#textureTileOpacity").html('Opacity: 0%');}
else changeTileOpacity(launch.texture_opacity,1);}else{$("#textureOpacitySlider").slider('value',25);changeTileOpacity(25,1);}
if(launch.product_id!=undefined&&launch.product_id!=0){currentProductID=launch.product_id;if(partner!=''){}}
if(launch.offset_x!=undefined){productOffsetX=0;}else productOffsetX=0;if(launch.offset_y!=undefined){productOffsetY=0;}else productOffsetY=0;var patNode=document.getElementById('previewPattern');patNode.setAttributeNS(null,'x',productOffsetX);patNode.setAttributeNS(null,'y',productOffsetY);launchedOnce=true;if(caller=='saved')updateStateStr('launchFromSaved');}
function loadSVG(patPropStr,caller){if(svgLoading==false){if(!(caller=='user'&&showPatternDeleteBoxes==1)){svgLoading=true;if(caller=='index')changeTab('edit',0);$("#preview").removeClass('previewLoaded').addClass('previewLoading');var patPropArray=patPropStr.split("+");if(keepColors==true){var hexArray=patPropArray[1].split('-');numOfHex=hexArray.length;}else setLiveAttArray(patPropArray[1]);$("#editorSVGcontainer").empty();for(var i=0;i<svgAreaArray.length;i++){$("#"+svgAreaArray[i][0]+"TransformGroup").empty();}
currentPatID=patPropArray[0];for(i=0;i<masterPatArray.length;i++){if(masterPatArray[i][PATARRAY_ID_KEY]==currentPatID){currentPatternName=masterPatArray[i][PATARRAY_NAME_KEY].charAt(0).toUpperCase()+masterPatArray[i][PATARRAY_NAME_KEY].slice(1);currentPatternAuthor=masterPatArray[i][PATARRAY_AUTHOR_KEY];break;}}
updateAuthors();var xhr=new XMLHttpRequest;xhr.open('get','svg/p'+patPropArray[0]+'.svg',true);xhr.onreadystatechange=function(){if(xhr.readyState!=4)return;var svg=cloneToDoc(xhr.responseXML.documentElement,document);$("#editorSVGcontainer").append(svg);svgWidth=svg.getAttributeNS(null,"width");svgHeight=svg.getAttributeNS(null,"height");svgRatio=svgWidth/svgHeight;adjustEditorWidth();for(var i=0;i<svgAreaArray.length;i++){var tmpSVG=cloneToDoc(svg,document,svgAreaArray[i][0]+'_');$("#"+svgAreaArray[i][0]+"TransformGroup").append(tmpSVG);}
var patSizeMultiplier=1;if(caller=='index'){patSizeMultiplier=svgRatio>=1?2.5:1.25;}
var setSize=!patPropArray[2]?tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]:patPropArray[2]*patSizeMultiplier;if(setSize>maxTileSize)setSize=maxTileSize;changeTileSize(setSize,0,'stateTileWidth');initiateColors();$("#preview").removeClass('previewLoading').addClass('previewLoaded');svgLoading=false;launchingFromState=false;};xhr.send();}}}
function cloneToDoc(node,doc,idPrefix){if(!doc)doc=document;if(!idPrefix)idPrefix='';var clone=doc.createElementNS(node.namespaceURI,node.nodeName);for(var i=0,len=node.attributes.length;i<len;++i){var a=node.attributes[i];if(/^xmlns\b/.test(a.nodeName))continue;clone.setAttributeNS(a.namespaceURI,a.nodeName,a.nodeValue);}
for(var i=0,len=node.childNodes.length;i<len;++i){var c=node.childNodes[i];if(c.nodeType==1)clone.insertBefore(cloneToDoc(c,doc,idPrefix),null);}
var cloneID=clone.getAttributeNS(null,"id");if(cloneID!==null)clone.setAttributeNS(null,"id",idPrefix+cloneID);return clone;}
function changeTexture(textureID,passedSize){$(".textureCell").removeClass('activeTextureCell').addClass('deadTextureCell');$("#texture_"+textureID).addClass('activeTextureCell').removeClass('deadTextureCell');if(textureID==0)showHideTileLayer(1,0);if(currentTextureID==0&&textureID!=0)showHideTileLayer(1,1);currentTextureID=textureID;var textureIDpresentInArray=false;for(i=0;i<masterTextureArray.length;i++){if(masterTextureArray[i][PATARRAY_ID_KEY]==textureID){currentTextureName=masterTextureArray[i][PATARRAY_NAME_KEY].charAt(0).toUpperCase()+masterTextureArray[i][PATARRAY_NAME_KEY].slice(1);textureIDpresentInArray=true;break;}}
if(!textureIDpresentInArray)changeTexture(0,50);currentTextureTile=textureID;$("#textureLayer, #patternAreaTexture").css({"background-image":"url("+domainPath+"/gen/textures/500/t"+textureID+".png)"});updateAuthors();if(launchingFromState==false)updateStateStr('changeTexture');}
function changeTileSize(sizeVal,layer,source){if(layer==0){if(source=='stateTileWidth'){tileLayerArray[0][TILE_WIDTH_KEY]=parseInt(sizeVal);tileLayerArray[0][TILE_HEIGHT_KEY]=Math.round(sizeVal/svgRatio);tileWfloat=sizeVal;tileHfloat=sizeVal/svgRatio;tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]=svgRatio>=1?tileLayerArray[0][TILE_WIDTH_KEY]:tileLayerArray[0][TILE_HEIGHT_KEY];$("#patternSizeSlider").slider('value',tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]);$("#productSizeSlider").slider('value',tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]);$("#productAreaSlider").slider('value',tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]);}
else{tileLayerArray[0][TILE_SLIDERSIZEVAL_KEY]=sizeVal;tileWfloat=svgRatio>=1?sizeVal:sizeVal*svgRatio;tileHfloat=svgRatio>1?sizeVal/svgRatio:sizeVal;if(source=='area'){tileLayerArray[0][TILE_WIDTH_KEY]=Math.round(tileWfloat/pxAreaViewScale);tileLayerArray[0][TILE_HEIGHT_KEY]=Math.round(tileHfloat/pxAreaViewScale);}else{tileLayerArray[0][TILE_WIDTH_KEY]=Math.round(tileWfloat);tileLayerArray[0][TILE_HEIGHT_KEY]=Math.round(tileHfloat);}}
var childScalingRatio=svgRatio>=1?tileHfloat/260:tileWfloat/260;tilePrice=calcPrice(tileLayerArray[0][TILE_WIDTH_KEY],tileLayerArray[0][TILE_HEIGHT_KEY],'tile');var priceStr;if(tilePrice==0){priceStr='FREE';}else{priceStr='$'+tilePrice.toFixed(2);}
for(var i=0;i<svgAreaArray.length;i++){document.getElementById(svgAreaArray[i][0]+'TransformGroup').setAttributeNS(null,'transform','scale('+(childScalingRatio*svgAreaArray[i][1])+')');var patNode=document.getElementById(svgAreaArray[i][0]+'Pattern');patNode.setAttributeNS(null,"width",tileWfloat*svgAreaArray[i][1]);patNode.setAttributeNS(null,"height",tileHfloat*svgAreaArray[i][1]);}
if(ms_ie){var n=document.createTextNode(' ');$('#previewSVG, #areaSVG').append(n);setTimeout(function(){n.parentNode.removeChild(n)},0);}}
if(layer==1){tileLayerArray[1][TILE_SLIDERSIZEVAL_KEY]=sizeVal;if(source=='stateTextureWidth'){$("#textureSizeSlider").slider('value',sizeVal);}
if(source=='area'){checkMaxTextureSize();tileLayerArray[1][TILE_WIDTH_KEY]=Math.round(sizeVal/pxAreaViewScale);tileLayerArray[1][TILE_HEIGHT_KEY]=Math.round(sizeVal/pxAreaViewScale);}else{tileLayerArray[1][TILE_WIDTH_KEY]=sizeVal;tileLayerArray[1][TILE_HEIGHT_KEY]=sizeVal;}
$("#textureLayer, #patternAreaTexture").css({"background-size":sizeVal+"px "+sizeVal+"px"});}
$("#"+tileLayerArray[layer][TILE_TYPE_KEY]+"SizeBubble").html(tileLayerArray[layer][TILE_WIDTH_KEY]+"px&nbsp;by&nbsp;"+tileLayerArray[layer][TILE_HEIGHT_KEY]+"px");}
function changeTileOpacity(sliderOpacVal,layer){if(tileLayerArray[layer][TILE_OPACITY_KEY]==0&&sliderOpacVal>0)showHideTileLayer(layer,1);tileLayerArray[layer][TILE_OPACITY_KEY]=sliderOpacVal;$("#"+tileLayerArray[layer][TILE_TYPE_KEY]+"OpacityBubble").html(sliderOpacVal+"%");$("#"+tileLayerArray[layer][TILE_TYPE_KEY]+"TileOpacity").html('Opacity: '+sliderOpacVal+'%');if(layer==0){document.getElementById('previewSVGrect').setAttributeNS(null,'fill-opacity',(sliderOpacVal/100));document.getElementById('areaSVGrect').setAttributeNS(null,'fill-opacity',(sliderOpacVal/100));}
if(layer==1){$("#textureLayer, #patternAreaTexture").fadeTo(0,(sliderOpacVal/100));if(sliderOpacVal==0)changeTexture(0,50);}}
function showHideTileLayer(layer,showHide){if(showHide==0){tileLayerArray[layer][TILE_SHOW_KEY]=false;tileLayerArray[layer][TILE_OPACITY_KEY]=0;if(layer==0){document.getElementById('previewSVGrect').setAttributeNS(null,'fill-opacity',0);document.getElementById('areaSVGrect').setAttributeNS(null,'fill-opacity',0);}
if(layer==1){$("#textureLayer, #patternAreaTexture").fadeOut();$("#textureSliderMask, #downloadTexureMask").fadeTo(200,.7);}
$("#"+tileLayerArray[layer][TILE_TYPE_KEY]+"OpacitySlider").slider('value',0);}else{tileLayerArray[layer][TILE_SHOW_KEY]=true;if(tileLayerArray[layer][TILE_OPACITY_KEY]==0){var returnSet=layer==0?100:50;tileLayerArray[layer][TILE_OPACITY_KEY]=returnSet;$("#"+tileLayerArray[layer][TILE_TYPE_KEY]+"OpacitySlider").slider('value',returnSet);changeTileOpacity(returnSet,layer);}
if(layer==1){$("#"+tileLayerArray[layer][TILE_TYPE_KEY]+"Layer").fadeTo(0,(tileLayerArray[1][TILE_OPACITY_KEY]/100));$("#textureSliderMask, #downloadTexureMask").fadeOut();}
$("."+tileLayerArray[layer][TILE_TYPE_KEY]+"Row").fadeTo(200,1);}
if(launchingFromState==false)updateStateStr('showHideTileLayer');}
function changeSVGcolor(hex){liveAttArray[activeColor][0]=hex;var attIDstrArray=[['F','fill'],['S','stop-color'],['L','stroke']];for(var i=0;i<attIDstrArray.length;i++){var j=0;while(document.getElementById(attIDstrArray[i][0]+activeColor+"_"+j)){document.getElementById(attIDstrArray[i][0]+activeColor+"_"+j).setAttributeNS(null,attIDstrArray[i][1],'#'+hex);for(var k=0;k<svgAreaArray.length;k++){document.getElementById(svgAreaArray[k][0]+'_'+attIDstrArray[i][0]+activeColor+"_"+j).setAttributeNS(null,attIDstrArray[i][1],'#'+hex);}
j++;}}
if(activeColor==0)$("#textureColorLayer").css({'background-color':'#'+liveAttArray[0][0]});}
function setLiveAttArray(hexStr){var hexArray=hexStr.split('-');numOfHex=hexArray.length;var i=0;var j=0;while(j<maxLayers){liveAttArray[j][0]=hexArray[i];if(i==(hexArray.length-1))i=0;else i++;j++;}}
function initiateColors(){var swatchContainer=document.getElementById('colorSwatches');swatchContainer.style.height=svgContainerHeight+'px';var swatchHeight=parseInt(svgContainerHeight/numOfHex);while(swatchContainer.hasChildNodes()){swatchContainer.removeChild(swatchContainer.firstChild);}
var lastSwatchPadding=0;var i=0;var attributeM;while(i<numOfHex){if(numOfHex-1==i)lastSwatchPadding=svgContainerHeight-(swatchHeight*numOfHex);var swatchCellDiv=document.createElement('div');swatchCellDiv.id='swatchCellDiv'+i;swatchCellDiv.className='swatchCell';swatchCellDiv.style.top=(swatchHeight*i)+'px';swatchCellDiv.style.height=(swatchHeight+lastSwatchPadding)+'px';swatchContainer.appendChild(swatchCellDiv);var colorSwatchDiv=document.createElement('div');colorSwatchDiv.id='swatch'+i;colorSwatchDiv.className='colorSwatch';colorSwatchDiv.style.backgroundColor='#'+liveAttArray[i][0];colorSwatchDiv.onclick=function(){var c=this.id.substring(6);selectObj(c);}
swatchCellDiv.appendChild(colorSwatchDiv);var addColorDiv=document.createElement('div');addColorDiv.id='addColor'+i;addColorDiv.className='addColorButt';addColorDiv.onclick=function(){var d=this.id.substring(8);addColor(d);}
swatchCellDiv.appendChild(addColorDiv);i++;}
if(editorLoaded==false){makeColorSelectors();editorLoaded=true;}
var b=0;while(b<numOfHex){activeColor=b;changeSVGcolor(liveAttArray[b][0]);b++;}
selectObj(0);var svgCon=document.getElementById('editorSVGcontainer');svgCon.style.display='none';svgCon.offsetHeight;svgCon.style.display='block';}
function selectObj(k){var j=0;while(j<numOfHex){document.getElementById('swatch'+j).style.borderColor='#777';document.getElementById('swatch'+j).style.left='8px';document.getElementById('swatchCellDiv'+j).style.background='transparent';document.getElementById('swatch'+j).style.boxShadow='1px 2px 3px rgba(0,0,0,.5)';j++;}
document.getElementById('swatch'+k).style.borderColor='transparent';var leftPad=-1;document.getElementById('swatch'+k).style.left=leftPad+'px';document.getElementById('swatchCellDiv'+k).style.background='#000';document.getElementById('swatch'+k).style.boxShadow='none';activeColor=k;setHexBox(liveAttArray[k][0]);}
function setHexBox(colorVal){$("#hexBox").val('#'+colorVal).change();if(launchingFromState==false)updateStateStr('setHexBox');}
function hexStr(){var hexStr=liveAttArray[0][0];var i=1
while(i<numOfHex){hexStr+='-'+liveAttArray[i][0];i++;}
return hexStr;}
function adjustPriceTrack(){if(priceMode==0){}}/*chunk_codify*/var KEY_CODES={'tile_width':'a','tile_height':'b','area_width':'c','area_height':'d','offset_x':'e','offset_y':'f','pattern_opacity':'g','colors':'h','pattern_id':'i','texture_id':'j','texture_opacity':'k','texture_width':'l','texture_height':'m','product_id':'n'};var CALLER_CONFIGS={'save':'acdghi','svg':'acdghi','png':'acdghi','jpg':'acdghi','pdf':'acdghi','product':'acdefhin','public':'cdhi','print':'abhi'};var encode=function(json){var key,val,code,hex;var encoded='';for(key in KEY_CODES){val=json[key]
if(val!=undefined&&val!=null){code=KEY_CODES[key];hex=(key=='colors')?val.replace(/-/g,''):parseInt(val).toString(16).replace(/-/g,'M');if(code==null)throw("Unrecognised key supplied: '"+key+"'.");encoded+=code+hex.toUpperCase();}}
return encoded;};var encodeForType=function(json,fileType){var typeConfig=CALLER_CONFIGS[caller].split('');var i,key,val,codeToKey={},selected={};for(key in KEY_CODES){codeToKey[KEY_CODES[key]]=key}
for(i=0;i<typeConfig.length;i++){key=codeToKey[typeConfig[i]];val=json[key];if(val==null||val==undefined)return;selected[key]=val;}
return _encode(selected);};var addSeparators=function(hex){var i,sep='',len=hex.length-1;if(hex.length%6!=0)throw('Invalid colors hex supplied.');for(i=0;i<len;i++){sep+=hex[i]+((i+1)%6==0?'-':'');}
return sep+hex[i];};var decode=function(str){var mod=str.replace('pcoolr_','').replace(/M/g,'-').replace(/.png$/,'');var vals=mod.substring(1).split(/[a-z]/g);var codes=mod.replace(/[0-9A-F-]/g,'').split('');var i,key,val;var len=vals.length;var decoded={};var codeToKey={};if(vals.length!=codes.length||JSON.stringify(codes)!=JSON.stringify(codes.slice(0).sort())){throw("Invalid encoded string supplied.");}
for(key in KEY_CODES){codeToKey[KEY_CODES[key]]=key}
for(i=0;i<len;i++){key=codeToKey[codes[i]];if(key==null)throw("Invalid encoded string supplied.");val=(key=='colors')?addSeparators(vals[i]):parseInt(vals[i],16);decoded[key]=val;}
return decoded;};/*chunk_cart*/var currentTileDownloadArray=[];var currentAreaDownloadArray=[];var cartArray=[];var totalItemPrice=0;var orderCode='';$(function(){$("#cartIcon").click(function(){if(cartArray.length>0){$("#cart_container").fadeIn();cartScrollbar.tinyscrollbar_update();}});$(".addToCart").click(function(e){e.stopPropagation();var itemType=$(this).attr('id').split('_')[1];addDownloadToCart(itemType);});$(".getSubscription").click(function(e){e.stopPropagation();$(".connectContent").css({display:'none'});$("#connectContent0").css({display:'block'});subParamStr=$(this).attr('id');if(userID==0){$("#subscribeSignedOut").css({display:'block'});$("#connectToPaypal_container, #blackOut1").fadeIn();}
else{$("#subscribeSignedIn").css({display:'block'});checkout();}});$("#checkOut").click(function(){subParamStr=null;checkout();});$("#continueToPaypal").click(function(){$("#connectContent0").css({display:'none'});$("#connectContent1").css({display:'block'});if(userID==0){var suppliedEmail=$("#downloadEmail").val();var ck_email=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;if(ck_email.test(suppliedEmail)){$.get("api.php?OE="+suppliedEmail+"&OC="+orderCode,function(result){});}}});$("#continuePlay").click(function(){closeCheckout();location.reload();});});function secureCheckout(){paypal.Button.render({env:'sandbox',client:{sandbox:'AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUXlkA59kJXE7M6R',production:'Aco85QiB9jk8Q3GdsidqKVCXuPAAVbnqm0agscHCL2-K2Lu2L6MxDU2AwTZa-ALMn_N0z-s2MXKJBxqJ'},payment:function(){return paypal.rest.payment.create(this.props.env,this.props.client,{transactions:[{amount:{total:'0.01',currency:'USD'}}]});},onAuthorize:function(data,actions){return actions.payment.execute().then(function(){document.querySelector('#paypal-button-container').innerText='Payment Complete!';});}},'#paypal-button-container');}
function checkout(){$("#subscription_container").css({'z-index':29});blackOutMsg('Connecting to Paypal...!',true);var dg=new PAYPAL.apps.DGFlow({trigger:"continueToPaypal",expType:'mini'});if(subParamStr!=null){var paramsArray=subParamStr.split('_');var subPrice=parseInt(paramsArray[3]).toFixed(2)
var checkoutParamsStr='?T='+subPrice;checkoutParamsStr+='&N0='+paramsArray[2]+' month subscription - '+paramsArray[1]+' license';checkoutParamsStr+='&D0='+paramsArray[2]+' month subscription - '+paramsArray[1]+' license';checkoutParamsStr+='&A0='+subPrice;checkoutParamsStr+='&ID0='+subParamStr;checkoutParamsStr+='&NI=1';}else{var checkoutParamsStr='?T='+totalItemPrice.toFixed(2);for(var i=0;i<cartArray.length;i++){checkoutParamsStr+='&N'+i+'='+cartArray[i][0].substring(0,cartArray[i][0].indexOf('<br />'));checkoutParamsStr+='&D'+i+'='+cartArray[i][0].substring(cartArray[i][0].indexOf('<br />')+6);checkoutParamsStr+='&A'+i+'='+cartArray[i][2];checkoutParamsStr+='&ID'+i+'='+cartArray[i][7];}
checkoutParamsStr+='&NI='+i;}
$.get("apiCheckout.php"+checkoutParamsStr,function(result){var paypalURLArray=eval(result);if(paypalURLArray[0]=='success'){$("#continueToPaypal").attr('href',paypalURLArray[1]);$("#connectToPaypal_container").fadeIn();$("#cart_container").fadeOut('slow');orderCode=paypalURLArray[2];}else{errorBox('<b>An error occured whilst trying to connect to Paypal!</b><br />'+paypalURLArray[0]);}});}
function closeCheckout(){if($.cookie("cartItemCookie")==null||$.cookie("cartItemCookie")==''){cartArray=[];buildCartItems();}}
function addDownloadToCart(itemType){if(itemType=='tile')cartArray.unshift(currentTileDownloadArray);if(itemType=='area')cartArray.unshift(currentAreaDownloadArray);$("#inCart").text(cartArray.length);$("#blackOut").fadeOut('slow');$("#lightBox_container").fadeOut('slow');$("#cart_container").css({display:'block'});buildCartItems();if(itemType=='area'){var insertAreaThb=function(data){cartArray[0][1]=data[0].size;cartArray[0][4]=apiDomainPath+data[0].thb;cartArray[0][7]=data[0].downloadID;buildCartItems();}
changeTileSizeToFit();cartArray[0][3]=updateStateStr('return');cartArray[0][8]=downloadFormat;var textureApiStr='';if(tileLayerArray[1][TILE_SHOW_KEY]==true){textureApiStr="&XW="+tileLayerArray[1][TILE_WIDTH_KEY]+"&XH="+tileLayerArray[1][TILE_HEIGHT_KEY]+"&TT="+tileLayerArray[1][TILE_OPACITY_KEY]+"&tID="+currentTextureTile;}
$.get("raster.php?H="+hexStr()+"&P="+currentPatID+"&TW="+(tileWfloat/pxAreaViewScale)+"&TH="+(tileHfloat/pxAreaViewScale)+"&AW="+inputPXw.value+"&AH="+inputPXh.value+"&PT="+tileLayerArray[0][TILE_OPACITY_KEY]+textureApiStr+"&C=download_2&S="+cartArray[0][3]+"&U="+userID+"&F="+downloadFormat+"&DES="+cartArray[0][0],function(result){insertAreaThb(eval(result));});}}
function buildCartItems(caller){$('#itemTable').empty();if(cartArray.length==0){$("#cart_container").fadeOut();$("#cartIcon").removeClass('activeCart');}
else{$("#cartIcon").addClass('activeCart');if(caller!='init')$("#cart_container").fadeIn();}
$("#inCart").text(cartArray.length);var cartItemStr='';totalItemPrice=0;for(var i=0;i<cartArray.length;i++){var areaGenStr='';var thbCellLoaderStr='';if(cartArray[i][1]=='Calculating...'){areaGenStr='<div class="areaGenerating">Your file is being generated, this may take as long as a minute for large files</div>';thbCellLoaderStr='style="background: url(img/saveBtnLoader1.gif) no-repeat 43px 50%;"';}
$('#itemTable').append('<tr><td class="itemThb" '+thbCellLoaderStr+'><div class="itemThumb" style="background-image: url('+cartArray[i][4]+');margin-left:'+((100-cartArray[i][5])/2)+'px;width:'+cartArray[i][5]+'px;height:'+cartArray[i][6]+'px;" /></div></td><td class="itemData">'+cartArray[i][0]+areaGenStr+'</td><td class="itemFormat">'+cartArray[i][8].toUpperCase()+'</td><td class="itemFilesize">'+cartArray[i][1]+'</td><td id="deleteItemCell_'+i+'" class="itemDelete"></td><td class="itemPrice">$'+parseFloat(cartArray[i][2]).toFixed(2)+'</td></tr>');totalItemPrice+=parseFloat(cartArray[i][2]);var itemDeleteDiv=$('<div>',{id:'deleteItem_'+i,'class':'deleteItemBtn',click:function(){var itemID=$(this).attr('id').split('_')[1];cartArray.splice(itemID,1);buildCartItems();}});$("#deleteItemCell_"+i).append(itemDeleteDiv);if(i>0)cartItemStr+='+';cartItemStr+=cartArray[i].join(',');}
$.cookie("cartItemCookie",cartItemStr,{expires:300});$("#totalCartPrice").html('<span>Total:</span>&nbsp;&nbsp;&nbsp;$'+totalItemPrice.toFixed(2));$("#cartScrollbar > .viewport").css({height:(wH-200)+'px'});cartScrollbar.tinyscrollbar_update();}
function getCartArrayFromCookie(){if($.cookie("cartItemCookie")!=null&&$.cookie("cartItemCookie")!=''){var cArray=$.cookie("cartItemCookie").split('+');for(var i=0;i<cArray.length;i++){cartArray.push(cArray[i].split(','));}}}/*chunk_download*/var downloadHistoryArray=[];$(function(){$("#downloadFile").click(function(){window.location.href='download.php?file='+currentDownload+'&dID='+currentDownloadID;if(userLevel<3){$("#content_download").fadeOut();$("#content_donate").css({display:'block','background':'url('+currentDownload+')'});}});$("#downloadAssetFile").click(function(){window.location.href='download.php?file='+currentDownloadAsset+'&dID='+currentDownloadID;});$("#donateWithPaypal").click(function(){$("#ppReturnCancel, #ppReturn").val(domainPath+'/#'+currentStateString);$("#paypalDonateForm").submit();});$(".donateAmt").click(function(){$("#field_other").val($(this).val());});$("#myDownloadsMenuLink").click(function(e){e.stopPropagation();$("#blackOut1").fadeIn();buildDownloadHistory(false);$("#downloadHistory_container").fadeIn();downloadHistoryScrollbar.tinyscrollbar_update();});$("#downloadHistoryTable").on("click",".downloadHistoryThb",function(){var launchState=$(this).attr('id').split('_')[1];launchPcoolr(launchState,'saved');});$("#downloadHistoryTable").on("click",".deleteDownloadBtn",function(){var dID=$(this).attr('id').split('_')[1];blackOutMsg('Are you sure you want to delete this record from your download history?',false,'Yes',buildDownloadHistory,dID,true);});});var buildDownloadHistory=function(downloadIDtoDelete){function buildDownloadCells(){$('#downloadHistoryTable').empty();if(downloadHistoryArray.length==0)$('#downloadHistoryTable').append('<tr><td class="itemData">Empty!</td></tr>');else{$("#downloadHistoryNum").text(downloadHistoryArray.length);var downloadHistoryItemStr='';for(var i=0;i<downloadHistoryArray.length;i++){var downloadType=downloadHistoryArray[i].type==2?'a':'s';var thbPath='gen/downloaded/'+downloadHistoryArray[i].format+'/thbs/t_'+downloadType+'_'+downloadHistoryArray[i].state+'.jpg';var downloadPath='gen/downloaded/'+downloadHistoryArray[i].format+'/'+downloadHistoryArray[i].prefix+'_'+downloadType+'_'+downloadHistoryArray[i].state+'.'+downloadHistoryArray[i].format;$('#downloadHistoryTable').append('<tr><td class="downloadThb"><img id="download_'+downloadHistoryArray[i].state+'" class="downloadHistoryThb" src="'+thbPath+'" /></td><td class="itemData">'+downloadHistoryArray[i].description+'</td><td class="itemFormat">'+downloadHistoryArray[i].format.toUpperCase()+'</td><td class="itemFilesize">'+downloadHistoryArray[i].fileSize+'</td><td class="itemDate">Downloaded<br />'+downloadHistoryArray[i].date.replace(" ","<br />")+'</td><td class="itemDownload"><a class="bigBtn" href="download.php?file='+downloadPath+'"></a></td><td class="itemDelete"><div id="deleteDownload_'+downloadHistoryArray[i].downloadID+'" class="deleteDownloadBtn"></div></td></tr>');}}
$("#downloadHistoryScrollbar > .viewport").css({height:(wH-80)+'px'});downloadHistoryScrollbar.tinyscrollbar_update();}
if(downloadIDtoDelete){$.get("api.php?DUD=true&DID="+downloadIDtoDelete+"&U="+userID,function(result){for(d=0;d<downloadHistoryArray.length;d++){if(downloadHistoryArray[d].downloadID==downloadIDtoDelete)downloadHistoryArray.splice(d,1);}
buildDownloadCells();});}else{$.get("api.php?UDH=true&U="+userID,function(result){downloadHistoryArray=eval(result);buildDownloadCells();});}};/*chunk_areaPreview*/var patternUnitH=24;var patternUnitW=16;var currentMeasureUnits='px';var unitMultiplier=1;var numTilesToFit=2;var currentDPI=null;var inputW=null;var inputH=null;var inputR=null;var inputPXw=null;var inputPXh=null;var inputRes=null;var tilesToFit=null;var areaW=null;var areaH=null;var tilesToLooseFit=null;var tileBuildURL=null;var maxW=defaultMaxW;var maxH=defaultMaxH;var maxR=2000;var maxRes=600;var dimFocus='w';var dollarsPerMegapixel=4;var pxAreaViewScale=1;function initAreaPreviewer(){inputW=document.sizeInput.areaWidth;inputH=document.sizeInput.areaHeight;inputPXw=document.sizeInput.areaPXwidth;inputPXh=document.sizeInput.areaPXheight;inputR=document.sizeInput.repeatOther;inputRes=document.sizeInput.resolution;currentDPI=inputRes.value;setUnits($("input[name='unit']:checked").val(),true);document.getElementById('unitCell').innerHTML=currentMeasureUnits;setupUpdater();fitTiles(numTilesToFit);repeatFit($("input[name='repeatWH']:checked").val());}
function repeatFit(fit){tilesToFit=fit;changeTileSizeToFit();buildPreviewer(true,'hwfit');resetGenBtn();}
function fitTiles(tileNum){numTilesToFit=tileNum;inputR.value=tileNum;buildPreviewer(true,'fit');}
function setTileFitOnOpen(){if(tilesToFit=='w'){inputR.value=Math.round(inputPXw.value*100 / tileLayerArray[0][TILE_WIDTH_KEY])/100;changeTileSizeToFit();}else{inputR.value=Math.round(inputPXh.value*100 / tileLayerArray[0][TILE_HEIGHT_KEY])/100;changeTileSizeToFit();}}
function checkMaxTextureSize(){if(tileLayerArray[1][TILE_SLIDERSIZEVAL_KEY]>pxAreaViewScale*1000){tileLayerArray[1][TILE_SLIDERSIZEVAL_KEY]=pxAreaViewScale*1000;$("#areaAlert").html('Download texture size exceeded').fadeIn();}else $("#areaAlert").fadeOut();}
function buildPreviewer(ajaxResize,call){numTilesToFit=inputR.value;var innerPatDiv=document.getElementById('patternArea');if(ajaxResize==true){var areaAvailableH=inputPXh.value>wH-160?wH-160:inputPXh.value;var areaAvailableW=inputPXw.value>wW-430?wW-430:inputPXw.value;var areaRatio=patternUnitH/patternUnitW;if(areaAvailableH<=areaAvailableW*areaRatio){areaAvailableW=areaAvailableH/areaRatio;}
else if(areaAvailableW<areaAvailableH/areaRatio){areaAvailableH=areaAvailableW*areaRatio;}
else alert('measurement error! ');if(tilesToFit=='w'){areaW=parseInt(areaAvailableW);areaH=Math.round(areaW*areaRatio);}else{tileH=parseInt(areaAvailableH);areaW=Math.round(areaH/areaRatio);}
var minRulerCellInPX=5;var scaleIncrement=1;while(areaH<(patternUnitH*minRulerCellInPX)/scaleIncrement){scaleIncrement*=10;}
var numRulerCellsY=Math.ceil(patternUnitH/scaleIncrement);var numRulerCellsX=Math.ceil(patternUnitW/scaleIncrement);var rulerYDiv=document.getElementById('rulerY');while(rulerYDiv.hasChildNodes()){rulerYDiv.removeChild(rulerYDiv.firstChild);}
var rulerXDiv=document.getElementById('rulerX');while(rulerXDiv.hasChildNodes()){rulerXDiv.removeChild(rulerXDiv.firstChild);}
document.getElementById('patternAreaWrapper').style.width=(areaW+70)+'px';document.getElementById('patternAreaWrapper').style.height=(areaH+60)+'px';document.getElementById('patternAreaWrapper').style.marginLeft='-'+((areaW+60)/2)+'px';document.getElementById('patternAreaWrapper').style.marginTop='-'+(((areaH+80)/2))+'px';var decRulerCellY=(areaH/patternUnitH)*scaleIncrement;var decRulerCellX=(areaW/patternUnitW)*scaleIncrement;i=0;var rulerCellInPX=null;var currentRulerLen=0;var chopY=false;while(i<=numRulerCellsY){var rulerYcell=document.createElement('div');rulerYcell.className='rulerYcell';if(i%5==0)rulerYcellW=10;else rulerYcellW=6;rulerYcell.style.width=rulerYcellW+'px';if(i==numRulerCellsY)rulerYcell.style.height='0px';else{rulerCellInPX=Math.round((i+1)*decRulerCellY-currentRulerLen);if((rulerCellInPX+currentRulerLen)>areaH){rulerCellInPX=areaH-currentRulerLen;chopY=true;}
rulerYcell.style.height=rulerCellInPX+'px';currentRulerLen+=rulerCellInPX;}
rulerYDiv.appendChild(rulerYcell);if(i%10==0){var rulerNumberDiv=document.createElement('div');rulerNumberDiv.className='rulerNumberCellY';rulerNumberDiv.innerHTML=i*scaleIncrement;rulerYcell.appendChild(rulerNumberDiv);}
i++;if(chopY==true)i++;}
i=0;currentRulerLen=0;var chopX=false;while(i<=numRulerCellsX){var rulerXcell=document.createElement('div');rulerXcell.className='rulerXcell';if(i%5==0)
rulerXcell.style.height='10px';else{rulerXcell.style.height='6px';rulerXcell.style.marginTop='4px';}
if(i==numRulerCellsX)
rulerXcell.style.width='0px';else{rulerCellInPX=Math.round((i+1)*decRulerCellX-currentRulerLen);if((rulerCellInPX+currentRulerLen)>areaW){rulerCellInPX=areaW-currentRulerLen;chopX=true;}
rulerXcell.style.width=rulerCellInPX+'px';currentRulerLen+=rulerCellInPX;}
rulerXDiv.appendChild(rulerXcell);if(i%10==0){var rulerNumberDiv=document.createElement('div');rulerNumberDiv.className='rulerNumberCellX';rulerNumberDiv.innerHTML=i*scaleIncrement;rulerXcell.appendChild(rulerNumberDiv);}
i++;if(chopX==true)i++;}}
var screenDPI=96;var actualScreenInch=areaW / screenDPI;var actualScreenCm=areaW /(screenDPI / 2.54);var areaViewScale=null;pxAreaViewScale=areaW / inputPXw.value;if(currentMeasureUnits=='px')areaViewScale=Math.round((areaW*100)/ inputPXw.value);if(currentMeasureUnits=='cm')areaViewScale=Math.round((actualScreenCm*100)/ inputW.value);if(currentMeasureUnits=='inches')areaViewScale=Math.round((actualScreenInch*100)/ inputW.value);$("#scale").text('View: '+areaViewScale+'%');if(currentMeasureUnits!='px')$("#dpiNote").text('Using '+screenDPI+'dpi monitor');else $("#dpiNote").text('');changeTileSizeToFit();}
function setUnits(units,buildPreview){var currentRes=inputRes.value;if(units=='cm'){unitMultiplier=currentRes/2.54;maxW=Math.round((defaultMaxW/currentRes*2.54)*100)/ 100;maxH=Math.round((defaultMaxH/currentRes*2.54)*100)/ 100;patternUnitW=Math.round(inputPXw.value*(2.54/currentRes)*100)/ 100;patternUnitH=Math.round(inputPXh.value*(2.54/currentRes)*100)/ 100;}
if(units=='inches'){unitMultiplier=currentRes;maxW=Math.round((defaultMaxW/currentRes)*100)/ 100;maxH=Math.round((defaultMaxH/currentRes)*100)/ 100;patternUnitW=Math.round((inputPXw.value/currentRes)*100)/ 100;patternUnitH=Math.round((inputPXh.value/currentRes)*100)/ 100;}
if(units=='px'){unitMultiplier=1;maxW=defaultMaxW;maxH=defaultMaxH;patternUnitW=inputPXw.value;patternUnitH=inputPXh.value;$("#resolution").fadeOut();}else $("#resolution").fadeIn();if(buildPreview==true){inputW.value=patternUnitW;inputH.value=patternUnitH;}
if(inputW.value>maxW)inputW.value=maxW;if(inputH.value>maxH)inputH.value=maxH;document.getElementById('maxW').innerHTML=maxW+' '+units+' max @ '+currentRes+'dpi';document.getElementById('maxH').innerHTML=maxH+' '+units+' max @ '+currentRes+'dpi';currentMeasureUnits=units;$(".units").text(units);if(buildPreview==true)buildPreviewer(true,'setUnits');}
function fieldFocus(dim){dimFocus=dim;}
function changeTileSizeToFit(){if(tilesToFit=='w'){var areaTileSize=svgRatio<1?areaW /(inputR.value*svgRatio):areaW / inputR.value;actualAreaTileW=inputPXw.value / inputR.value;actualAreaTileH=actualAreaTileW / svgRatio;}
if(tilesToFit=='h'){var areaTileSize=svgRatio<1?areaH /(inputR.value / svgRatio):areaH / inputR.value;actualAreaTileH=inputPXh.value / inputR.value;actualAreaTileW=actualAreaTileH*svgRatio;}
console.log(areaTileSize);$("#downloadPatternSizeSlider").slider('value',areaTileSize);if(launchedOnce==true){changeTileSize(areaTileSize,0,'area');}
checkMaxTextureSize();}
function setupUpdater(){var timeout=null;var ratio=inputW.value/inputH.value;var aspectRatioCheckBox=document.sizeInput.aspectRatio;inputW.value=patternUnitW;inputH.value=patternUnitH;function clearMaxDimWarning(){document.getElementById('maxR').style.color='#fff';document.getElementById('maxW').style.color='#fff';document.getElementById('maxH').style.color='#fff';document.getElementById('aspectR').style.color='#777';inputR.style.color='#000';inputRes.style.color='#000';inputW.style.color='#000';inputH.style.color='#000';}
function handleChange(){var inFocus=null;function validateInput(inStr,dec){if(dec==1)inStr=inStr.replace(/[^0-9.]/g,"");else inStr.replace(/[^\d]/g,"");if(inStr==0)inStr=0.1;if(inStr.slice(-1)!='.')inStr=Math.round(inStr*100)/100;return inStr;}
if(dimFocus=='h'){inFocus=inputH;inputH.value=validateInput(inputH.value,1);if(aspectRatioCheckBox.checked){inputW.value=Math.round((inputH.value*ratio)*100)/100;if(currentMeasureUnits=='px')inputW.value=Math.round(inputW.value);}}
if(dimFocus=='w'){inFocus=inputW;inputW.value=validateInput(inputW.value,1);if(aspectRatioCheckBox.checked){inputH.value=Math.round((inputW.value/ratio)*100)/100;if(currentMeasureUnits=='px')inputH.value=Math.round(inputH.value);}}
if(dimFocus=='r'){inFocus=inputR;inputR.value=validateInput(inputR.value,0);if(inputR.value>maxR){inputR.value=maxR;document.getElementById('maxR').style.color='#f77';setTimeout(clearMaxDimWarning,3000);inputR.style.color='#f77';}}
if(dimFocus=='res'){inFocus=inputRes;inputRes.value=validateInput(inputRes.value,0);if(inputRes.value>maxRes){inputRes.value=maxRes;setTimeout(clearMaxDimWarning,3000);inputRes.style.color='#f77';}
currentDPI=inputRes.value;if(currentMeasureUnits=='cm'){inputPXw.value=Math.round(inputW.value*inputRes.value / 2.54);inputPXh.value=Math.round(inputH.value*inputRes.value / 2.54);}
if(currentMeasureUnits=='inches'){inputPXw.value=Math.round(inputW.value*inputRes.value);inputPXh.value=Math.round(inputH.value*inputRes.value);}}
if(inputW.value>maxW){inputW.value=maxW;if(aspectRatioCheckBox.checked){inputH.value=Math.round(maxW/ratio);if(inputH.value>=maxH){inputH.value=maxH;inputH.style.color='#f77';document.getElementById('maxH').style.color='#f77';document.getElementById('aspectR').style.color='#f77';}}
document.getElementById('maxW').style.color='#f77';setTimeout(clearMaxDimWarning,3000);inputW.style.color='#f77';}
if(inputH.value>maxH){inputH.value=maxH;if(aspectRatioCheckBox.checked){inputW.value=Math.round(maxH*ratio);if(inputW.value>=maxW){inputW.value=maxW;inputW.style.color='#f77';document.getElementById('maxW').style.color='#f77';document.getElementById('aspectR').style.color='#f77';}}
document.getElementById('maxH').style.color='#f77';setTimeout(clearMaxDimWarning,3000);inputH.style.color='#f77';}
if(dimFocus=='w'||dimFocus=='h'){inputPXh.value=Math.round(inputH.value*unitMultiplier);inputPXw.value=Math.round(inputW.value*unitMultiplier);}
areaPrice=calcPrice(inputPXw.value,inputPXh.value,'area');$("#area_price").text('$'+areaPrice.toFixed(2));if(!aspectRatioCheckBox.checked)ratio=inputW.value/inputH.value;if(isNaN(inFocus.value)||inFocus.value==0)inFocus.value='';if(isNaN(inputW.value)||inputW.value==0)inputW.value='';if(isNaN(inputH.value)||inputH.value==0)inputH.value='';if(isNaN(ratio)||ratio==0)ratio=1;setUnits(currentMeasureUnits,false);adjustDownloadItem();updateStateStr('noUndo');resetGenBtn();}
var timeout1=null;function eventHandler(event){function applyInputs(){if(dimFocus=='res'&&currentMeasureUnits=='px'){var dpiAdjuster=inputRes.value/currentDPI;currentDPI=inputRes.value;inputH.value=Math.round(inputH.value*dpiAdjuster);inputW.value=Math.round(inputW.value*dpiAdjuster);patternUnitH=inputH.value;patternUnitW=inputW.value;}
buildPreviewer(true,'event');}
handleChange();if(timeout)clearTimeout(timeout);timeout=setTimeout(applyInputs,500);}
inputW.onkeyup=eventHandler;inputH.onkeyup=eventHandler;inputR.onkeyup=eventHandler;inputRes.onkeyup=eventHandler;handleChange();}
function standardSize(sizeStr){document.body.focus();var sizeArray=sizeStr.split("x");patternUnitW=sizeArray[0];patternUnitH=sizeArray[1];setupUpdater();buildPreviewer(true,'standardSize');}
function adjustDownloadItem(){var textureNameStr=tileLayerArray[1][TILE_SHOW_KEY]==true?' / '+currentTextureName:'';var dimensionStr=inputW.value+currentMeasureUnits+' x '+inputH.value+currentMeasureUnits;if(currentMeasureUnits!='px')dimensionStr+=' @ '+currentDPI+'dpi';var cartItemStr='Pattern area '+dimensionStr+'<br />'+currentPatternName+textureNameStr;var areaRatio=inputPXw.value / inputPXh.value;var itemThumbW=areaRatio>1?100:areaRatio*100;var itemThumbH=itemThumbW/areaRatio;currentAreaDownloadArray=[cartItemStr,'Calculating...',areaPrice.toFixed(2),'','img/trans85blk.png',Math.round(itemThumbW),Math.round(itemThumbH),'',''];}
function resetGenBtn(){$("#generateInactive").fadeOut();$("#downloadInactive, #downloadAssetInactive").fadeIn();$("#downloadArea_size").html('File size: Not known until <span class="selectedFormat">'+downloadFormat.toUpperCase()+'</span> generated');}
function generateAreaRaster(){$("#generateInactive, #genLoader").fadeIn();var insertAreaThb=function(data){$("#downloadArea_size").text('File size: '+data[0].size);currentDownload=data[0].path;currentDownloadAsset=data[0].texturePath;$("#genLoader").delay(500).fadeOut('slow',function(){$("#downloadInactive, #downloadAssetInactive").fadeOut('fast');});}
changeTileSizeToFit();var areaStateStr=updateStateStr('return');var textureApiStr='';if(tileLayerArray[1][TILE_SHOW_KEY]==true){textureApiStr="&XW="+tileLayerArray[1][TILE_WIDTH_KEY]+"&XH="+tileLayerArray[1][TILE_HEIGHT_KEY]+"&TT="+tileLayerArray[1][TILE_OPACITY_KEY]+"&tID="+currentTextureTile;}
$.get("raster.php?H="+hexStr()+"&P="+currentPatID+"&TW="+(tileWfloat/pxAreaViewScale)+"&TH="+(tileHfloat/pxAreaViewScale)+"&AW="+inputPXw.value+"&AH="+inputPXh.value+"&PT="+tileLayerArray[0][TILE_OPACITY_KEY]+textureApiStr+"&C=download_2&S="+areaStateStr+"&U="+userID+"&F="+downloadFormat+"&DES=NULL",function(result){insertAreaThb(eval(result));});}/*chunk_init_editor*/$(function(){if(userName!=0)signedInOut(1);else signedInOut(0);var initPcoolr=function(data){masterPatArray=data[0];masterTextureArray=data[1];adjustToSreenSize();getCartArrayFromCookie();setContainers();loadTags();buildTextureCells();buildThbCells();tilesToFit=$('input[name=repeatWH]:checked').val();shuffleTypeSelect(2);getCookieStrs();changeTab('color',0);changeTab('download',0);changeTab('edit',0);$(".clickClear").css({color:"#bbb"});$('input[name="searchBox"]').val('Search patterns');$("#container").fadeIn('slow');$("#pageLoader").css({display:'none'});buildCartItems('init');initAreaPreviewer();userScrollbar.tinyscrollbar_update();cartScrollbar.tinyscrollbar_update();var stateHash=getStateFromHash();var launchStateStr=stateHash?stateHash:data[2][0];launchPcoolr(launchStateStr);undoArray=[launchStateStr];buildColorSelector(0.5);if(typeof productView!=='undefined'){if(productView)showProductView();}
loadSocialScripts();$("#navNext, #navPrev, #download_optionsBtn, #pCoolrLogo").addClass("bgColorMid");}
var partnerURLstr=''
if(partner!=''){partnerURLstr='&PTID='+partnerID;}
$.get("api.php?P=true"+partnerURLstr,function(result){initPcoolr(eval(result));});});/*chunk_social*/$(function(){$(".socialBtn").click(function(){var shareProvider=$(this).attr('id').split('_')[1];sendSocial(shareProvider);});})
function loadSocialScripts(){}
function sendSocial(provider){var domain=domainPath+'/#'+currentStateString;if(provider=='su'){var stumbleURL='http://www.stumbleupon.com/submit?url='+domain;window.location.href=stumbleURL;}else{var buildSocialData=function(data){var socialImgPath=domainPath+'/'+data[0].path;var socialImgStrArray=data[0].path.split('/');var socialImg=socialImgStrArray[socialImgStrArray.length-1];var heading=currentPatternName+' pattern I created on Patterncooler.com';var description='Have fun with this easy-to-use yet powerful free resource applying your own colors and textures to 10,000s of beautiful downloadable pattern designs. Whether you are a professional designer or just someone wanting a new background for your twitter profile, you may be very glad you stumbled on this unique project by Harvey Rayner'
var encodeDomainURL=encodeURIComponent(domain);var encodeImgSrc=encodeURIComponent(socialImgPath);var encodeDescription=encodeURIComponent(heading+' - '+description);if(provider=='pn'){var pinURL='//gb.pinterest.com/pin/create/button/?url='+encodeDomainURL+'&media='+encodeImgSrc+'&description='+encodeDescription;window.location.href=pinURL;}
if(provider=='fb'){FB.ui({method:'feed',name:heading,link:domain,picture:socialImgPath,caption:'www.patterncooler.com',description:description,message:''});}
if(provider=='tb'){var tumblrURL="http://www.tumblr.com/share/photo?source="+encodeImgSrc+"&caption="+encodeDescription+"&clickthru="+encodeDomainURL;window.location.href=tumblrURL;}
if(provider=='gl'){$('#socialShare_container, #blackOut').fadeIn();$('#socialShareIframe').prop('src',domainPath+'/share/gl/'+socialImg.replace('.png','_png').replace('.jpg','_jpg'))}
if(provider=='tw'){$('#socialShare_container, #blackOut').fadeIn();$('#socialShareIframe').prop('src',domainPath+'/share/tw/'+socialImg.replace('.png','_png').replace('.jpg','_jpg'))}}
var format=currentTextureID==0?'png':'jpg';var defaultSize=500;var socialImgScaler=500;var socialImgW=500;var socialImgH=500;if(provider=='fb'){socialImgScaler=158;socialImgW=158;socialImgH=158;}
if(provider=='gl'){socialImgScaler=400;socialImgW=506;socialImgH=303;}
if(provider=='tw'){socialImgScaler=400;socialImgW=560;socialImgH=375;}
var socialTileW=Math.round(tileLayerArray[0][TILE_WIDTH_KEY]*(socialImgScaler/defaultSize));var socialTileH=Math.round(tileLayerArray[0][TILE_HEIGHT_KEY]*(socialImgScaler/defaultSize));var socialTextureSize=Math.round(tileLayerArray[1][TILE_WIDTH_KEY]*(socialImgScaler/defaultSize));$.get("raster.php?H="+hexStr()+"&P="+currentPatID+"&TW="+socialTileW+"&TH="+socialTileH+"&XW="+socialTextureSize+"&XH="+socialTextureSize+"&AW="+socialImgW+"&AH="+socialImgH+"&TT="+tileLayerArray[1][TILE_OPACITY_KEY]+"&tID="+currentTextureTile+"&C=social_"+provider+"&S="+currentStateString+"&F="+format+"&D=",function(result){buildSocialData(eval(result));});}}